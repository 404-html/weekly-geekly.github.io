<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Add Basic Auth to a SOAP request using ksoap2-android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It so happened that as part of my work I contacted a project to develop an application for communication Android and 1C. A quick search on the Interne...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Add Basic Auth to a SOAP request using ksoap2-android</h1><div class="post__text post__text-html js-mediator-article">  It so happened that as part of my work I contacted a project to develop an application for communication Android and 1C.  A quick search on the Internet gave quite clear instructions and pieces of code that very quickly formed into a ready-made program, but she did not want to run.  Here I will tell the main subtleties and ways to solve them. <br><a name="habracut"></a><br>  The original sources of the code are listed <a href="https://habrahabr.ru/post/145389/">here</a> and <a href="http://www.cyberforum.ru/android-dev/thread909551.html">here</a> .  It is only necessary to connect the third-party ksoap2-android library so that the classes SoapObject and HttpTransportSE become available.  The old proven way to download jar from the <a href="https://oss.sonatype.org/content/repositories/ksoap2-android-releases">official repository</a> and put it in app / libs for some reason did not succeed, and I began to look at how to connect the library using modern Gradle.  Almost all the resources have been written that a simple addition <br><br><pre><code class="java hljs">dependencies { compile <span class="hljs-string"><span class="hljs-string">'com.google.code.ksoap2-android:ksoap2-android:3.6.1'</span></span> }</code> </pre> <br>  should "pull" the necessary resources.  But this did not happen, because  the resource itself is not in standard repositories.  So, you need to specify where to download it.  This is done by adding the following lines to the project's Gradle file: <br><br><pre> <code class="java hljs">buildTypes { repositories { maven { url <span class="hljs-string"><span class="hljs-string">'https://oss.sonatype.org/content/repositories/ksoap2-android-releases'</span></span> } } }</code> </pre><br>  After these simple steps, just sync the project, and Gradle will download everything you need. <br>  Here is the code that starts working after the above procedures: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataLoader</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncTask</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String NAMESPACE = <span class="hljs-string"><span class="hljs-string">"namespace"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String URL = <span class="hljs-string"><span class="hljs-string">"http://host/wsdlAcceptor?wsdl"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SOAP_ACTION = <span class="hljs-string"><span class="hljs-string">"http://host/wsdlAcceptor"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String METHOD_NAME = <span class="hljs-string"><span class="hljs-string">"testOperation"</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPreExecute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onPreExecute(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Void... params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { SoapObject request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SoapObject(NAMESPACE, METHOD_NAME); SoapSerializationEnvelope envelope = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SoapSerializationEnvelope(SoapEnvelope.VER10); request.addProperty(<span class="hljs-string"><span class="hljs-string">"IsFirstRequest"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); envelope.setOutputSoapObject(request); HttpTransportSE androidHttpTransport = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpTransportSE(URL); androidHttpTransport.debug = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { androidHttpTransport.call(SOAP_ACTION, envelope); SoapObject resultsRequestSOAP = (SoapObject) envelope.bodyIn; System.out.println(<span class="hljs-string"><span class="hljs-string">"Response::"</span></span>+resultsRequestSOAP.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { e.printStackTrace(); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPostExecute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onPostExecute(result); } }</code> </pre><br>  It is no secret that working with any network activity should be done from a separate asynchronous task.  doInBackground is the standard AsyncTask method.  If you are not familiar yet, then <a href="http://developer.alexanderklimov.ru/android/theory/asynctask.php">here</a> it is written about him simply and very clearly. <br><br>  The MainActivity itself looks like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); DataLoader dl = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataLoader(); dl.execute(); } }</code> </pre><br>  At this adventure does not end there.  In my case, the request to the server was closed by Basic Auth, so it was necessary to enter the login and password somewhere.  And I haven‚Äôt found an unequivocal answer to this question on the Internet.  In many articles, a certain class HttpTransportBasicAuthSE was mentioned, in the constructor of which a login with a password is passed.  But it was not found in ksoap2-android, I had to search the Internet.  Found <a href="httptransportbasicauth">here</a> .  I quote the full text: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpTransportBasicAuthSE</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpTransportSE</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String username; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String password; <span class="hljs-comment"><span class="hljs-comment">/** * Constructor with username and password * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> url * The url address of the webservice endpoint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> username * Username for the Basic Authentication challenge RFC 2617 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> password * Password for the Basic Authentication challenge RFC 2617 */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HttpTransportBasicAuthSE</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String url, String username, String password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(url); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.username = username; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password = password; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ServiceConnection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getServiceConnection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ ServiceConnectionSE midpConnection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceConnectionSE(url); addBasicAuthentication(midpConnection); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> midpConnection; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addBasicAuthentication</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ServiceConnection midpConnection)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (username != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; password != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { StringBuffer buf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(username); buf.append(<span class="hljs-string"><span class="hljs-string">':'</span></span>).append(password); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] raw = buf.toString().getBytes(); buf.setLength(<span class="hljs-number"><span class="hljs-number">0</span></span>); buf.append(<span class="hljs-string"><span class="hljs-string">"Basic "</span></span>); org.kobjects.base64.Base64.encode(raw, <span class="hljs-number"><span class="hljs-number">0</span></span>, raw.length, buf); midpConnection.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>, buf.toString()); } } }</code> </pre><br>  I suppose, comments to the code are superfluous.  I‚Äôll only clarify that in order to use HttpTransportBasicAuthSE, it‚Äôs enough just to change the line in the DataLoader <br><br><pre> <code class="java hljs">HttpTransportSE androidHttpTransport = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpTransportSE(URL);</code> </pre><br>  on <br><br><pre> <code class="java hljs">HttpTransportBasicAuthSE androidHttpTransport = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpTransportBasicAuthSE(URL, <span class="hljs-string"><span class="hljs-string">"basicLogin"</span></span>, <span class="hljs-string"><span class="hljs-string">"authPassword"</span></span>);</code> </pre><br>  and everything starts to work with authorization very clearly! <br><br>  PS: do not forget to add permission to Internet to Manifest <br><br><pre> <code class="java hljs">&lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"android.permission.INTERNET"</span></span> /&gt;</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/340642/">https://habr.com/ru/post/340642/</a></p>
<section class="all-articles-navigation-panel js-all-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>