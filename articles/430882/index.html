<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Xiaomi Aqara Switch rework from ZigBee to Z-Wave</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I decided to try to integrate ZigBee switches into my home Z-Wave automation. For experiments, I purchased an inexpensive ZigBee battery-operated swit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Xiaomi Aqara Switch rework from ZigBee to Z-Wave</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/n7/ke/va/n7kevawzvuk65h83ji2t-pgs2uu.jpeg"><br><br>  I decided to try to integrate ZigBee switches into my home Z-Wave automation.  For experiments, I purchased an inexpensive ZigBee battery-operated switch Xiaomi Aqara Smart Switch.  It looks beautiful, plastic of the highest quality, very pleasant, a key switch with a spring mechanism, which gives a full tactile feedback. <br><br>  The switch planned to use in the following scenarios: <br><br><ul><li>  With a single click on / off the night light </li><li>  with a long hold dim nightlight </li><li>  when pressed twice turn on / off the LED backlight </li></ul><br>  But testing has shown that the Xiaomi Aqara Smart Switch only responds to a single tap.  And when I tried to pause and hold the <b>key for 5 seconds, it was reset to factory settings</b> .  In this form, the Aqara Smart Switch turned out to be useless for me and I decided to make a Z-Wave switch with all the functions I needed in its case. <br><br><img src="https://habrastorage.org/webt/zj/sg/rn/zjsgrnu1t9blxyy_fkughm2gt9i.png" width="300" align="right">  The basis of the Z-Wave switch is the Z-Uno Module - a small board on which, only the Z-Wave chip and memory, is programmed from the Arduino environment via USB.  The module with a size of 25x15x1.9 mm provides access to all the pins of the Z-Wave chip.  The module has a U.FL connector for connecting the antenna, or you can simply solder the 86 mm wire.  This is the same Z-Uno for device manufacturers only. <br><a name="habracut"></a><br>  I recently made several different Z-Wave switches, all looking for the perfect solution: <br><br><ol><li>  <a href="https://habr.com/post/413473/">Development of a touch battery Z-Wave switch with luminous buttons</a> </li><li>  <a href="https://habr.com/post/396839/">Switch Gira + Z-Wave.</a>  <a href="https://habr.com/post/396839/">4-button radio switch based on Z-Uno</a> </li><li>  <a href="https://habr.com/post/372041/">Touch radio switch on batteries.</a>  <a href="https://habr.com/post/372041/">Livolo + z-uno</a> </li><li>  <a href="https://habr.com/company/zwave/blog/392857/">Alteration of the push-button radio switch to touch</a> </li></ol><br>  The development of the circuit breaker board did not take long.  But in the course of work had to solve several problems. <br><br>  Initially, I manufactured a 1.6 mm PCB test board, soldering a Z-Uno with a height of 1.9 mm onto it, it turned out that the design does not pass in height, I had to use 1 mm PCB, the same as on the original Xiaomi board. <br><br>  Making the fixture for the CR2032 battery turned out to be problematic, so I removed it from the original board, and also used the tantalum capacitor 220mF from the original board. <br>  Xiaomi also has a version with two buttons, so I made a universal charge.  I got much less components for soldering than Xiaomi, the entire binding of the Z-Wave chip is already on the module.  By experience, I solder the buttons without flux, so that I do not wash them later, otherwise after washing the board, the buttons quickly stop working. <br><br>  The production of boards ordered in seeedstudio, came out 1000r with delivery for 10 pcs., As usual very pleased with the quality, the color is black gloss. <br><br><img src="https://habrastorage.org/webt/9s/ec/gr/9secgr8hk4dvserjkjltrfzyq1k.jpeg"><br><br>  Circuitry, as from the first lesson on the Arduino - a pair of buttons and LEDs. <br><br><img src="https://habrastorage.org/webt/wi/te/ro/witeroumoz1clghiwnotqkfsc3s.png"><br><br>  For Z-Uno there is a convenient library for working with buttons, short presses, long and double clicks are supported.  Triple click is a system combination, used to add a device to the Z-Wave controller and send an information packet. <br><br><img src="https://habrastorage.org/webt/-t/ob/0u/-tob0ujcf4-q38kbaqtgcjabwni.png"><br><br>  When any button is pressed, the ground closes on the INT 18 through the diodes and Z-Uno wakes up, then the buttons are polled. <br><br>  The sketch is poured via USB, for this, on the back of the board I provided GND, 3V, DM, DP points.  Additionally, you need the RESET button to put Z-Uno into programming mode.  Debugging can be done on the UART, they are in Z-Uno 2, both are iron. <br><br><img src="https://habrastorage.org/webt/vx/mt/gk/vxmtgkp5juot60hikrnvogpu1a0.jpeg"><br><br>  As I planned, I implemented 3 device management scenarios, the configuration is performed using the Z-Wave RaZberry controller.  There are 4 groups of associations.  The first group to send to the battery charge controller.  The second group for devices controlled only by short taps, i.e.  can only turn on / off.  The third group for dimmable devices, I have a nightlight in it.  The fourth group for devices managed by double clicks, in it I will put the LED backlight. <br><br><img src="https://habrastorage.org/webt/nk/0q/el/nk0qelugtgnamklcn7dad-_lfsu.png"><br><br>  The finished board goes great in the case, like a native one.  The CR2032 battery should last about a year of work, but practice will show that you may have to optimize something else.  I really like the design of the switch, I will assemble another version with two keys. <br><br><img src="https://habrastorage.org/webt/6e/sc/dh/6escdh4nzze-cowie9mwhzcakfe.jpeg"><br><br><img src="https://habrastorage.org/webt/ms/rz/9c/msrz9cv0bm0rtaiyem7epbsx7em.jpeg"><br><br>  The price of the question was: 2500r (Z-Uno) + 1000r (Xiaomi Aqara Smart Switch) + 100r (1 board) = 3600r.  The pleasure from the development process is priceless! </div><p>Source: <a href="https://habr.com/ru/post/430882/">https://habr.com/ru/post/430882/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>