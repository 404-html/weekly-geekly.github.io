<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Spring Boot solving a problem with ManyToMany</title>
  <meta name="description" content="The article is addressed to you, wandering in the darkness of the night. You, whose path is illuminated only lonely fireflies. In general, a programme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Spring Boot solving a problem with ManyToMany</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/kn/c9/or/knc9or-mu2dwlrj2v_occjguuqm.png"><br><br>  The article is addressed to you, wandering in the darkness of the night.  You, whose path is illuminated only lonely fireflies.  In general, a programmer who studies Spring Boot and ManyToMany's relationship to Hibernate. <br><br>  He did a test task on an abstract musical theme: write a service for storing data about musicians, songs, albums using Java, Spring, Hibernate.  Part of the task was the creation of the classes ‚ÄúCompositions‚Äù and ‚ÄúArtists‚Äù.  The composition can be performed by many performers, and the performer can perform many compositions.  Typical bidirectional relationship ManyToMany. <br><br>  The Khasang courses told you how to avoid looping rest requests to Spring using the DTO class, but Spring Boot is another story.  On Russian-language websites I saw answers like ‚ÄúYes, this is all elementary,‚Äù but without specific explanations.  I will give an example of solving this problem.  The full code is posted on the githab, link below. <br><a name="habracut"></a><br>  First create the Entity: People and SongPlayers.  Getters and setters omitted for short. <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">People</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.AUTO) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String human; <span class="hljs-comment"><span class="hljs-comment">//–Ω–µ—Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π –∏–≥—Ä–∞—é—Ç –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ @ManyToOne(cascade = CascadeType.ALL) private RockGroups rockGroups; //—Ä–∞–∑–Ω—ã–µ –ª—é–¥–∏ –∏—Å–ø–æ–ª–Ω—è—é—Ç —Ä–∞–∑–Ω—ã–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ @ManyToMany(mappedBy = "songInstrumentalist",fetch = FetchType.EAGER) private List&lt;SongPlayers&gt; songItems; public People(){} public People(long id, String human){ this.id = id; this.human = human; } //. . . . . . . . . }</span></span></code> </pre> <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SongPlayers</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.AUTO) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String song; <span class="hljs-comment"><span class="hljs-comment">//—É –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –æ–¥–∏–Ω –∫–æ–º–ø–æ–∑–∏—Ç–æ—Ä private String composer; // –∏ –æ–¥–∏–Ω –∞–≤—Ç–æ—Ä —Å—Ç–∏—Ö–æ–≤ private String poet; //–ø–µ—Å–Ω—è —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ –∞–ª—å–±–æ–º–µ private String album; //–∏ –º–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π //–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª–Ω—è—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–µ—Å–Ω–∏ @ManyToMany(cascade = CascadeType.ALL, fetch = FetchType.EAGER) private List&lt;People&gt; songInstrumentalist; //. . . . . . . . . }</span></span></code> </pre> <br>  Then we create Repository interfaces for the People class. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Repository</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeopleRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">People</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"select h from People h where h.human=?1"</span></span>) <span class="hljs-function"><span class="hljs-function">List&lt;People&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">searchByHuman</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String human)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">List&lt;People&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findPeopleByHuman</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String human)</span></span></span></span>; }</code> </pre> <br>  And for the SongPlayers class <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Repository</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SongPlayersRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SongPlayers</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">List&lt;SongPlayers&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findSongPlayersBySong</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String song)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">List&lt;SongPlayers&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findSongPlayersByComposer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String composer)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">List&lt;SongPlayers&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findSongPlayersByPoet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String poet)</span></span></span></span>; }</code> </pre> <br>  The <a href="https://habr.com/users/repository/" class="user_link">Repository</a> annotation extends the <a href="https://habr.com/users/component/" class="user_link">Component</a> annotation, which allows the implemented class to make bean and autowiring, respectively. <br><br>  Extending the JpaRepository interface allows you to perform the necessary CRUD operations without additional description and other useful things. <br><br>  Now you need to create DTO classes for Entity People and SongPlayers.  Here I will give only PeopleDTO so as not to clutter the article.  Getters and setters dropped again. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeopleDTO</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String human; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RockGroups rockGroups; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;SongPlayersDTO&gt; songPlayersList; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;PeopleDTO&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPeopleDTOList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;People&gt; peopleList)</span></span></span></span>{ List&lt;PeopleDTO&gt; peopleDTOList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (People people : peopleList){ songPlayersList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); PeopleDTO peopleDTO = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PeopleDTO(); peopleDTO.setId(people.getId()); peopleDTO.setHuman(people.getHuman()); peopleDTO.setRockGroups(people.getRockGroups()); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (SongPlayers songPlayers : people.getSongItems()){ SongPlayersDTO songPlayersDTO = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SongPlayersDTO(); songPlayersDTO.setId(songPlayers.getId()); songPlayersDTO.setSong(songPlayers.getSong()); songPlayersDTO.setPoet(songPlayers.getPoet()); songPlayersDTO.setComposer(songPlayers.getComposer()); songPlayersDTO.setAlbum(songPlayers.getAlbum()); songPlayersList.add(songPlayersDTO); } peopleDTO.setSongPlayersList(songPlayersList); peopleDTOList.add(peopleDTO); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> peopleDTOList; } <span class="hljs-comment"><span class="hljs-comment">//. . . . . . . . . }</span></span></code> </pre> <br>  By analogy, the SongPlayersDTO class is also created.  Select the required fields for display in the rest - answer. <br><br>  Create a controller for the people.  Attention, watch your hands! <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/people"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeopleController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PeopleRepository repository; <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/all"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;PeopleDTO&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAllPeople</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ PeopleDTO peopleDTO = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PeopleDTO(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> peopleDTO.getPeopleDTOList(repository.findAll()); } <span class="hljs-comment"><span class="hljs-comment">//. . . . . . . }</span></span></code> </pre> <br>  Yeah, you say.  This will not work.  And where is the implementation of the PeopleRepository interface? <br>  Will work, the PeopleRepository class is created on the fly!  Just fantastic. <br><br>  Now compare the number of generated classes and interfaces for an identical project on Spring and Spring Boot <br><table><tbody><tr><th>  classes in the Spring project </th><th>  classes in Spring Boot </th></tr><tr><th><img src="https://habrastorage.org/webt/8t/gn/ke/8tgnkenstjb68tpwdbasatwwlcm.png"></th><th><img src="https://habrastorage.org/webt/ns/w_/_p/nsw__pxjayeplamsed59l8qzewu.png"></th></tr></tbody></table><br>  I wish you all successful programming.  Waiting for your comments. <br><br><ul><li>  <a href="https://github.com/developerc/achekhtestsb">Link project on githaba.</a> </li></ul><br>  Used Books: <br><br><ul><li>  Felipe Gutierrez Pro Spring Boot </li><li>  Craig Walls Spring in action 5-th edition </li></ul></div><p>Source: <a href="https://habr.com/ru/post/432318/">https://habr.com/ru/post/432318/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>