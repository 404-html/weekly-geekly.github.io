<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pattern: Saga</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I present to your attention the translation of the article "Pattern: Saga" by Chris Richardson. 
 Situation 


 There is an application to w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <div class="page-header-logo-container"></div>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pattern: Saga</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi, Habr!  I present to your attention the translation of the article <a href="https://microservices.io/patterns/data/saga.html">"Pattern: Saga"</a> by Chris Richardson. </p><br><h2 id="situaciya">  Situation </h2><br><p>  There is an application to which the <a href="https://microservices.io/patterns/data/database-per-service.html">Database per Service</a> pattern was applied.  Now each application service has its own database.  Some business transactions cover several services at once, so a mechanism is needed to ensure consistency of data between these services. </p><br><p>  For example: let's imagine that we are developing an online store where the client has a credit limit.  The application must ensure that the new order does not exceed the customer's credit limit.  Since Orders and Clients are different databases, the application cannot use local ACID transactions. </p><br><h2 id="problema">  Problem </h2><br><p>  How to ensure data consistency between services? </p><br><h2 id="reshenie">  Decision </h2><br><p>  It is necessary to implement each business transaction that covers several services as a saga. </p><br><p>  <strong>The saga</strong> is a collection of local transactions.  Each local transaction updates the database and publishes a message or event, initiating the next local transaction in the saga.  If a transaction fails, for example, because of a violation of business rules, then the saga launches offsetting transactions that roll back the changes made by previous local transactions. </p><br><p><img src="https://habrastorage.org/webt/ar/un/50/arun50xz7tpk50elikanbfvmih0.jpeg"></p><a name="habracut"></a><br><p>  There are two ways to coordinate sagas: </p><br><ul><li>  Choreography (Choreography) - each transaction publishes events that trigger transactions in other services. </li><li>  Orchestration (Orchestration) - the orchestrator tells participants what transactions should be started. </li></ul><br><h3 id="primer-saga-osnovannaya-na-horeografii">  Example: a saga based on choreography </h3><br><p><img src="https://habrastorage.org/webt/js/3z/he/js3zheu17ixdqx7kshzu3a1troe.jpeg"></p><br><p>  In an online store using a saga based on choreography, creating an order will include the following steps: </p><br><ol><li> <code>Order Service (–°–µ—Ä–≤–∏—Å –ó–∞–∫–∞–∑–∞)</code> creates an <code>Order (–ó–∞–∫–∞–∑)</code> in the status of <em>pending (pending)</em> and publishes an event <code>OrderCreated (–ó–∞–∫–∞–∑–°–æ–∑–¥–∞–Ω)</code> </li><li>  <code>Customer Service (–°–µ—Ä–≤–∏—Å –ö–ª–∏–µ–Ω—Ç–∞)</code> receives the event and attempts to reserve a loan for the order.  After that, it publishes one of two events: <code>CreditReserved (–ö—Ä–µ–¥–∏—Ç–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω)</code> or <code>CreditLimitExceeded (–ö—Ä–µ–¥–∏—Ç–Ω—ã–π–õ–∏–º–∏—Ç–ü—Ä–µ–≤—ã—à–µ–Ω)</code> </li><li>  <code>Order Service (–°–µ—Ä–≤–∏—Å –ó–∞–∫–∞–∑–∞)</code> receives the event and changes the status of the order to <em>approved (</em> <em>canceled</em> <em>)</em> or <em>canceled.</em> </li></ol><br><h3 id="primer-saga-osnovannaya-na-orkestrovke">  Example: Orchestrated Saga </h3><br><p><img src="https://habrastorage.org/webt/f3/22/k7/f322k7jnklklszp65pww-x6ujaq.jpeg"></p><br><p>  In an online store using an orchestration-based saga, order creation will include the following steps: </p><br><ol><li>  <code>Order Service (–°–µ—Ä–≤–∏—Å –ó–∞–∫–∞–∑–∞)</code> creates an <code>Order (–ó–∞–∫–∞–∑)</code> in <em>pending (pending)</em> status and creates <code>CreateOrderSaga (–°–∞–≥–∞–°–æ–∑–¥–∞–Ω–∏—è–ó–∞–∫–∞–∑–∞)</code> </li><li>  <code>CreateOrderSaga (–°–∞–≥–∞–°–æ–∑–¥–∞–Ω–∏—è–ó–∞–∫–∞–∑–∞)</code> sends the <code>ReserveCredit (–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å–ö—Ä–µ–¥–∏—Ç)</code> team <code>ReserveCredit (–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å–ö—Ä–µ–¥–∏—Ç)</code> to the <code>Customer Service (–°–µ—Ä–≤–∏—Å –ö–ª–∏–µ–Ω—Ç–∞)</code> </li><li>  <code>Customer Service (–°–µ—Ä–≤–∏—Å –ö–ª–∏–µ–Ω—Ç–∞)</code> tries to reserve a loan for the order and sends back an answer. </li><li>  <code>CreateOrderSaga (–°–∞–≥–∞–°–æ–∑–¥–∞–Ω–∏—è–ó–∞–∫–∞–∑–∞)</code> receives a response and sends an <code>ApproveOrder (–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å–ó–∞–∫–∞–∑)</code> <code>Order Service (–°–µ—Ä–≤–∏—Å –ó–∞–∫–∞–∑–∞)</code> <code>ApproveOrder (–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å–ó–∞–∫–∞–∑)</code> or <code>RejectOrder (–û—Ç–º–µ–Ω–∏—Ç—å–ó–∞–∫–∞–∑)</code> <code>Order Service (–°–µ—Ä–≤–∏—Å –ó–∞–∫–∞–∑–∞)</code> <code>RejectOrder (–û—Ç–º–µ–Ω–∏—Ç—å–ó–∞–∫–∞–∑)</code> command in the <code>Order Service (–°–µ—Ä–≤–∏—Å –ó–∞–∫–∞–∑–∞)</code> </li><li>  <code>Order Service (–°–µ—Ä–≤–∏—Å –ó–∞–∫–∞–∑–∞)</code> changes the order status to <em>approved (confirmed)</em> or <em>canceled.</em> </li></ol><br><h3 id="saga-imeet-sleduyuschie-preimuschestva">  The saga has the following advantages </h3><br><ul><li>  Allows an application to maintain data consistency across services without using distributed transactions. </li></ul><br><h3 id="saga-imeet-sleduyuschie-nedostatki">  The saga has the following disadvantages </h3><br><ul><li>  The programming model becomes more complex.  For example, developers must design offsetting transactions that undo changes made earlier in the saga. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/427705/">https://habr.com/ru/post/427705/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>