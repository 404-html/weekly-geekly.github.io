<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Private classes. Hiding in php</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In php, as in most other OOP languages, there are visibility modifiers. These are the keywords public, protected and private. But they apply exclusive...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <div class="page-header-logo-container"></div>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Private classes. Hiding in php</h1><div class="post__text post__text-html js-mediator-article"><p>  In php, as in most other OOP languages, there are visibility modifiers.  These are the keywords public, protected and private.  But they apply exclusively to properties, methods, or constants.  These modifiers are closely related to the ability to encapsulate data.  It is worth noting that in languages ‚Äã‚Äãsuch as java, C #, go ( <a href="">https://golang.org/doc/go1.4#internalpackages</a> ), ruby ‚Äã‚Äã( <a href="https://habr.com/post/419969/">https://habr.com/post/419969/</a> ), crystal ( <a href="https://crystal-lang.org/reference/syntax_and_semantics/visibility.html">https : //crystal-lang.org/reference/syntax_and_semantics/visibility.html</a> ) it is possible to limit the scope of packages (packages) or classes \ types.  In php there is no possibility to limit the scope for classes - any connected class is accessible from any other class.  However, you can emulate this feature using several tricks. </p><a name="habracut"></a><br><p>  For which you may need to hide at the class level: </p><br><ul><li>  Library service classes (helpers) - do not litter the library API with non-meaningful internal classes. </li><li>  Encapsulation with hiding internal business logic objects, for example, prohibiting direct generation of dependent objects, bypassing a more general class. </li></ul><br><p>  Separately, you can select the partition of the "large" classes into small objects.  It is considered good practice to limit the complexity (and the number of lines) of both individual methods and classes.  The number of lines here goes as one of the markers, that the class method or the class itself takes on unnecessary responsibility.  When refactoring a public method, we move parts of it to private \ protected methods.  But when, for one reason or another, a class grows and we separate a separate entity from it, these most private \ protected classes are transferred to a separate class, thus we indirectly open access to methods that were previously limited to the scope of one class. </p><br><p>  Now, the actual methods of emulation of concealment. </p><br><h3 id="na-urovne-soglasheniya-oformleniya-koda">  At the level of agreement code design </h3><br><p> Using PHPDoc comments, you can mark a class, trait, or interface as <code>internal</code> ( <a href="http://docs.phpdoc.org/references/phpdoc/tags/internal.html">http://docs.phpdoc.org/references/phpdoc/tags/internal.html</a> ).  However, some IDE (for example PhpStorm) can understand such tags. </p><br><h3 id="ispolzovat-runtime-informaciyu">  Use runtime information </h3><br><p>  During execution of the code, you can check where the class constructor was called from.  For example, through the <code>debug_backtrace</code> method ( <a href="http://php.net/manual/ru/function.debug-backtrace.php">http://php.net/manual/ru/function.debug-backtrace.php</a> ) or use the same Xdebug functionality to control the code in the dev \ test environment.  An example of a framed solution is here ( <a href="https://coderwall.com/p/ixvnga/how-emulates-private-class-concept-in-php">https://coderwall.com/p/ixvnga/how-emulates-private-class-concept-in-php</a> ). </p><br><div class="spoiler">  <b class="spoiler_title">use debug_backtrace</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * The private class */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PrivateClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * defines the only class able to instantiate the current one * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $allowedConsumer = <span class="hljs-string"><span class="hljs-string">'AllowedPrivateClassConsumer'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * constructor * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> Exception */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * here comes the privacy filter, it could be extracted to a private method * or to a static method of another class with few adjustments */</span></span> $builder = debug_backtrace(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($builder) &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> || !<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($builder[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-string"><span class="hljs-string">'class'</span></span>]) || $builder[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-string"><span class="hljs-string">'class'</span></span>] !== <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;allowedConsumer) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'Need to be instantiated by '</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;allowedConsumer); } } }</code> </pre> </div></div><br><h3 id="ispolzovat-anonimnye-klassy">  Use anonymous classes </h3><br><p>  Relatively new features in php are anonymous classes ( <a href="http://php.net/manual/ru/language.oop5.anonymous.php">http://php.net/manual/ru/language.oop5.anonymous.php</a> ).  By describing an anonymous class inside a protected method, we seek to hide it.  In order not to enclose the class definition inside a function, you can describe the "private" class in a separate file as abstract, and already expand it in the definition of an anonymous class.  A good example of using this method is at this link ( <a href="https://markbakeruk.net/2018/06/25/using-php-anonymous-classes-as-package-private-classes/">https://markbakeruk.net/2018/06/25/using-php-anonymous-classes-as-package-private-classes/</a> ). </p><br><p>  Based on the material found, it is clear that the class-hiding functionality is to some extent in demand (and exists in many languages), but the practice of its use is very limited, possibly lacking a description of examples in various "best practices", template collections and similar sources.  Which in my opinion is rather strange, that there is an emphasis on hiding the internal methods and properties of objects, but almost no one pays attention that larger logical pieces of code in the form of utility classes of libraries or domain domains remain in the global visibility space. </p></div><p>Source: <a href="https://habr.com/ru/post/435894/">https://habr.com/ru/post/435894/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>