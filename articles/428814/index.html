<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Comparison of products using Elasticsearch for a competitor price monitoring service</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Back in 2017, the idea arose to develop a service for monitoring the prices of competitors. Its distinctive feature from other similar services should...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <div class="page-header-logo-container"></div>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Comparison of products using Elasticsearch for a competitor price monitoring service</h1><div class="post__text post__text-html js-mediator-article">  Back in 2017, the idea arose to develop a service for monitoring the prices of competitors.  Its distinctive feature from other similar services should have been the function of daily automatic comparison of goods.  Apparently because of the almost complete lack of information on how to do this, price monitoring services offered only the possibility of manual comparison by the customers themselves, or by service operators with a price from 0.2 to 1 ruble for the fact of comparison.  The real situation with, for example, 10 sites and 20,000 products on each, inevitably requires automation of the process, since manual matching is too long and expensive. <br><br>  An approach to automatic matching will be described below using a number of competing pharmacies using the <a href="https://www.elastic.co/">Elaticsearch</a> technology. <br><a name="habracut"></a><br><h2>  Environment description </h2><br><ol><li>  OS: Windows 10 </li><li>  Base: Elaticsearch 6.2 </li><li>  Client for requests: Postman 6.2 </li></ol><br><h2>  Elaticsearch setup </h2><br>  Configuration of the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/indices-put-mapping.html">product mapper</a> and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/indices-update-settings.html">analyzer</a> fields in one request <br><br><pre><code class="hljs pgsql">PUT http://localhost:<span class="hljs-number"><span class="hljs-number">9200</span></span>/app { "mappings": { "product": { "properties": { "name": { "type": "text", "analyzer": "name_analyzer" # —É–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –∏–º–µ–Ω–∏ —Ç–æ–≤–∞—Ä–∞ }, "manufacturer": { "type": "text" }, "city_id": { "type": "integer" }, "company_id": { "type": "integer" }, "category_id": { "type": "integer" }, } } }, "settings": { "index": { "analysis": { "analyzer": { "name_analyzer": { "type": "custom", "tokenizer": "standard", # –ø—Ä–æ —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω–∞–π–∑–µ—Ä –º–æ–∂–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, –≤ —Ü–µ–ª–æ–º –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ–¥ –Ω–∞—à—É –∑–∞–¥–∞—á—É "char_filter": [ "html_strip", # —É–¥–∞–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ –ø–æ–ø–∞–≤—à–∏–µ –≤ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ html —Ç–µ–≥–∏ "comma_to_dot_char_filter" # –∑–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—ã–µ –Ω–∞ —Ç–æ—á–∫–∏, —á—Ç–æ–±—ã –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–∏—Å–ª–∞ –ø–∞—Ä—Å–∏–ª–∏—Å—å ], "filter": [ "word_delimeter_filter", # —É–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Ç–µ—Ä–º–æ–≤ "synonym_filter", # –¥–æ–±–∞–≤–ª—è–µ–º –≥—Ä—É–ø–ø—ã —Å–∏–Ω–æ–Ω–∏–º–æ–≤ "lowercase" # –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤—Å–µ –≤ –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä ] } }, "filter": { "synonym_filter": { "type": "synonym_graph", "synonyms": [ "—Ç—é–±, —Ç—é–±–∏–∫", "–∫–∞–ø, –∫–∞–ø–µ–ª—å–Ω–∏—Ü–∞", "–∫–∞–ø—Å, –∫–∞–ø—Å—É–ª–∞", "–∞–º–ø, –∞–º–ø—É–ª–∞, –∞–º–ø—É–ª—ã", "–æ—Ñ—Ç–∞–ª—å–º–æ–ª, –æ—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π", "—Ç–∞–±, —Ç–±–ª, —Ç–∞–±–ª, —Ç–∞–±–ª–µ—Ç–∫–∏", "—É–≤–ª, —É–≤–ª–∞–∂–Ω—è—é—â–∏–π", "–Ω–∞–∑, –Ω–∞–∑–∞–ª—å–Ω—ã–π", "–¥–æ–∑, –¥–æ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –¥–æ–∑–∏—Ä–æ–≤–∫–∞", "–∂–µ–≤, –∂–µ–≤–∞—Ç, –∂–µ–≤–∞—Ç–µ–ª—å–Ω—ã–µ", "—Ä–∞—Å—Ç–≤, —Ä–∞—Å—Ç–≤–æ—Ä, —Ä–∞—Å—Ç–≤–æ—Ä–∏–º—ã–µ, —Ä-—Ä–∞, —Ä-—Ä", "–∏–Ω, –∏–Ω—ä–µ–∫—Ü–∏–π, –∏–Ω—ä–µ–∫—Ü–∏—è", "–ø–æ–∫—Ä, –ø–æ–∫—Ä—ã—Ç—ã–π, –ø–æ–∫—Ä—ã—Ç–∞—è, –ø–æ–∫—Ä—ã—Ç—ã–µ", "–∏–Ω–¥, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è", "–∫–æ–Ω—Ç, –∫–æ–Ω—Ç—É—Ä–Ω–∞—è", "—É–ø, —É–ø–∞–∫, —É–ø–∞–∫–æ–≤–∫–∞", "—Ä–∞—Å—Å, —Ä–∞—Å—Å–∞—Å, —Ä–∞—Å—Å–∞—Å—ã–≤–∞–Ω–∏—è", "–ø–æ–¥—ä—è–∑—ã—á, –ø–æ–¥—ä—è–∑—ã—á–Ω—ã–µ", "—à–∏–ø, —à–∏–ø—É—á–∏–µ", "–ø–æ—Ä, –ø–æ—Ä–æ—à–µ–∫", "–ø—Ä–∏–≥, –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è", "—à—Ç, —à—Ç—É–∫, –Ω–æ–º, –Ω–æ–º–µ—Ä", "—Ç—Ä, —Ç—Ä–∞–≤–∞", "–≥, g", "ml, –º–ª" ] }, "word_delimeter_filter": { "type": "word_delimiter", "type_table": [ ". =&gt; DIGIT", # —á—Ç–æ–±—ã –ø–æ–ø–∞–¥–∞–ª–∏ –≤ —Ç–µ—Ä–º—ã –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–∏—Å–ª–∞ "- =&gt; ALPHANUM", "; =&gt; SUBWORD_DELIM", "` =&gt; SUBWORD_DELIM" ] } }, "char_filter": { "comma_to_dot_char_filter": { "type": "mapping", "mappings": [ ", =&gt; ." ] } } } } } }</code> </pre> <br>  For example, we can look at which parts of the analyzer ‚Äúname_analyzer‚Äù will break the name of the drug ‚ÄúHyoxysone 10mg + 30mg / g ointment for external use of the 10g tube‚Äù.  Use the query <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/indices-analyze.html">_analyze</a> . <br><br><pre> <code class="hljs pgsql">POST http://localhost:<span class="hljs-number"><span class="hljs-number">9200</span></span>/app/_analyze { "analyzer" : "name_analyzer", "text" : "–ì–∏–æ–∫—Å–∏–∑–æ–Ω 10–º–≥+30–º–≥/–≥ –º–∞–∑—å –¥–ª—è –Ω–∞—Ä—É–∂–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç—É–±–∞ 10–≥" }</code> </pre> <br>  result <br><pre> <code class="hljs objectivec">{ <span class="hljs-string"><span class="hljs-string">"tokens"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"–≥–∏–æ–∫—Å–∏–∑–æ–Ω"</span></span>, <span class="hljs-string"><span class="hljs-string">"start_offset"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"end_offset"</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;ALPHANUM&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"position"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, { <span class="hljs-string"><span class="hljs-string">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"10"</span></span>, <span class="hljs-string"><span class="hljs-string">"start_offset"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"end_offset"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;ALPHANUM&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"position"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }, { <span class="hljs-string"><span class="hljs-string">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"–º–≥"</span></span>, <span class="hljs-string"><span class="hljs-string">"start_offset"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">"end_offset"</span></span>: <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;ALPHANUM&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"position"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> }, { <span class="hljs-string"><span class="hljs-string">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"30"</span></span>, <span class="hljs-string"><span class="hljs-string">"start_offset"</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-string"><span class="hljs-string">"end_offset"</span></span>: <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;ALPHANUM&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"position"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> }, { <span class="hljs-string"><span class="hljs-string">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"–º–≥"</span></span>, <span class="hljs-string"><span class="hljs-string">"start_offset"</span></span>: <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-string"><span class="hljs-string">"end_offset"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;ALPHANUM&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"position"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> }, { <span class="hljs-string"><span class="hljs-string">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"g"</span></span>, <span class="hljs-string"><span class="hljs-string">"start_offset"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"end_offset"</span></span>: <span class="hljs-number"><span class="hljs-number">21</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"SYNONYM"</span></span>, <span class="hljs-meta"><span class="hljs-meta">#–≤–∏–¥–∏–º, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"g"</span></span></span><span class="hljs-meta"> –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∞—Å—å –∫–∞–∫ SYNONYM, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω–∞ —Å–æ–≤–ø–∞–¥–µ—Ç —Å –ª—é–±—ã–º –≤—Ö–æ–∂–¥–µ–Ω–∏–µ–º —Å–≤–æ–µ–π –≥—Ä—É–ø–ø—ã —Å–∏–Ω–æ–Ω–∏–º–æ–≤ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"–≥, g"</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"position"</span></span></span><span class="hljs-meta">: 5 }, { </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"–≥"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"start_offset"</span></span></span><span class="hljs-meta">: 20, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"end_offset"</span></span></span><span class="hljs-meta">: 21, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"type"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"&lt;ALPHANUM&gt;"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"position"</span></span></span><span class="hljs-meta">: 5 }, { </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"–º–∞–∑—å"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"start_offset"</span></span></span><span class="hljs-meta">: 22, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"end_offset"</span></span></span><span class="hljs-meta">: 26, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"type"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"&lt;ALPHANUM&gt;"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"position"</span></span></span><span class="hljs-meta">: 6 }, { </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"–¥–ª—è"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"start_offset"</span></span></span><span class="hljs-meta">: 27, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"end_offset"</span></span></span><span class="hljs-meta">: 30, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"type"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"&lt;ALPHANUM&gt;"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"position"</span></span></span><span class="hljs-meta">: 7 }, { </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"–Ω–∞—Ä—É–∂–Ω–æ–≥–æ"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"start_offset"</span></span></span><span class="hljs-meta">: 31, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"end_offset"</span></span></span><span class="hljs-meta">: 40, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"type"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"&lt;ALPHANUM&gt;"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"position"</span></span></span><span class="hljs-meta">: 8 }, { </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"–ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"start_offset"</span></span></span><span class="hljs-meta">: 41, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"end_offset"</span></span></span><span class="hljs-meta">: 51, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"type"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"&lt;ALPHANUM&gt;"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"position"</span></span></span><span class="hljs-meta">: 9 }, { </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"—Ç—É–±–∞"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"start_offset"</span></span></span><span class="hljs-meta">: 52, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"end_offset"</span></span></span><span class="hljs-meta">: 56, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"type"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"&lt;ALPHANUM&gt;"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"position"</span></span></span><span class="hljs-meta">: 10 }, { </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"10"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"start_offset"</span></span></span><span class="hljs-meta">: 57, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"end_offset"</span></span></span><span class="hljs-meta">: 59, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"type"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"&lt;ALPHANUM&gt;"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"position"</span></span></span><span class="hljs-meta">: 11 }, { </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"g"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"start_offset"</span></span></span><span class="hljs-meta">: 59, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"end_offset"</span></span></span><span class="hljs-meta">: 60, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"type"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SYNONYM"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"position"</span></span></span><span class="hljs-meta">: 12 }, { </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"–≥"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"start_offset"</span></span></span><span class="hljs-meta">: 59, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"end_offset"</span></span></span><span class="hljs-meta">: 60, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"type"</span></span></span><span class="hljs-meta">: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"&lt;ALPHANUM&gt;"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"position"</span></span></span><span class="hljs-meta">: 12 } ] }</span></span></code> </pre> <br><h2>  Filling with test data </h2><br>  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/docs-bulk.html">_Bulk</a> request <br><br><pre> <code class="hljs ruby">POST <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/localhost:9200/</span></span>_bulk { <span class="hljs-string"><span class="hljs-string">"index"</span></span>: { <span class="hljs-string"><span class="hljs-string">"_index"</span></span>: <span class="hljs-string"><span class="hljs-string">"app"</span></span>, <span class="hljs-string"><span class="hljs-string">"_type"</span></span>: <span class="hljs-string"><span class="hljs-string">"product"</span></span>, <span class="hljs-string"><span class="hljs-string">"_id"</span></span>: <span class="hljs-number"><span class="hljs-number">195111</span></span> } } { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"–ì–∏–æ–∫—Å–∏–∑–æ–Ω 10–º–≥+30–º–≥/–≥ –º–∞–∑—å –¥–ª—è –Ω–∞—Ä—É–∂–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç—É–±–∞ 10–≥"</span></span>, <span class="hljs-string"><span class="hljs-string">"manufacturer"</span></span>: <span class="hljs-string"><span class="hljs-string">"–ú—É—Ä–æ–º—Å–∫–∏–π –ø—Ä–∏–±–æ—Ä–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–≤–æ–¥ –ê–û"</span></span>, <span class="hljs-string"><span class="hljs-string">"city_id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"company_id"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"category_id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } { <span class="hljs-string"><span class="hljs-string">"index"</span></span>: { <span class="hljs-string"><span class="hljs-string">"_index"</span></span>: <span class="hljs-string"><span class="hljs-string">"app"</span></span>, <span class="hljs-string"><span class="hljs-string">"_type"</span></span>: <span class="hljs-string"><span class="hljs-string">"product"</span></span>, <span class="hljs-string"><span class="hljs-string">"_id"</span></span>: <span class="hljs-number"><span class="hljs-number">195222</span></span> } } { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"–ì–ò–û–ö–°–ò–ó–û–ù –º–∞–∑—å –¥–ª—è –Ω–∞—Ä—É–∂–Ω–µ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è 10 –º–≥+30 –º–≥/–≥: 10 –≥"</span></span>, <span class="hljs-string"><span class="hljs-string">"manufacturer"</span></span>: <span class="hljs-string"><span class="hljs-string">"–ú–ü–ó"</span></span>, <span class="hljs-string"><span class="hljs-string">"city_id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"company_id"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"category_id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre><br><h2>  Search mappings </h2><br>  Let the goods of our client, for which we want to find all similar products of competitors, have characteristics <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"–ì–∏–æ–∫—Å–∏–∑–æ–Ω –º–∞–∑—å –¥–ª—è –Ω–∞—Ä—É–∂–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è 10 –º–≥+30 –º–≥/–≥ —Ç—É–±–∞ –∞–ª—é–º–∏–Ω–∏–µ–≤–∞—è 10 –≥"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"manufacturer"</span></span>: <span class="hljs-string"><span class="hljs-string">"–ú—É—Ä–æ–º—Å–∫–∏–π –ø—Ä–∏–±–æ—Ä–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–≤–æ–¥ –ê–û"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"city_id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"company_id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"category_id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre><br>  Using the <a href="https://grls.rosminzdrav.ru/Default.aspx">reference book of medicines we</a> select the name of the drug from the name of the product.  In this case, the word "hyoxyson"  This word will be a mandatory criterion. <br><br>  We also cut out all the numbers from the name - ‚Äú10 30 10‚Äù, they will also be an obligatory criterion.  Moreover, if some number was included twice, it should also be included in the found goods, otherwise we will increase the chance of coincidence with the wrong goods. <br><br>  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search.html">_Search query</a> <br><br><pre> <code class="hljs smalltalk"><span class="hljs-type"><span class="hljs-type">GET</span></span> http://localhost:<span class="hljs-number"><span class="hljs-number">9200</span></span>/app/product/_search { <span class="hljs-comment"><span class="hljs-comment">"query"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"bool"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"filter"</span></span>: [ { <span class="hljs-comment"><span class="hljs-comment">"terms"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"company_id"</span></span>: [ <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span> ] } }, { <span class="hljs-comment"><span class="hljs-comment">"term"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"city_id"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-comment"><span class="hljs-comment">"boost"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } } }, { <span class="hljs-comment"><span class="hljs-comment">"term"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"category_id"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-comment"><span class="hljs-comment">"boost"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } } } ], <span class="hljs-comment"><span class="hljs-comment">"must"</span></span>: [ { <span class="hljs-comment"><span class="hljs-comment">"bool"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"should"</span></span>: [ { <span class="hljs-comment"><span class="hljs-comment">"match"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"name"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"query"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"–º–∞–∑—å –¥–ª—è –Ω–∞—Ä—É–∂–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–≥+ –º–≥/–≥ —Ç—É–±–∞ –∞–ª—é–º–∏–Ω–∏–µ–≤–∞—è –≥"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"boost"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-comment"><span class="hljs-comment">"operator"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"or"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"minimum_should_match"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-comment"><span class="hljs-comment">"fuzziness"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"AUTO"</span></span> } } } ], <span class="hljs-comment"><span class="hljs-comment">"must"</span></span>: [ { <span class="hljs-comment"><span class="hljs-comment">"match"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"name"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"query"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"–ì–∏–æ–∫—Å–∏–∑–æ–Ω"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"boost"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-comment"><span class="hljs-comment">"operator"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"or"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"minimum_should_match"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"70%"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"fuzziness"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"AUTO"</span></span> } } }, { <span class="hljs-comment"><span class="hljs-comment">"match_phrase"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"name"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"query"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"10 30 10"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"boost"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-comment"><span class="hljs-comment">"slop"</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> } } } ] } } ], <span class="hljs-comment"><span class="hljs-comment">"should"</span></span>: [ { <span class="hljs-comment"><span class="hljs-comment">"bool"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"should"</span></span>: [ { <span class="hljs-comment"><span class="hljs-comment">"match"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"manufacturer"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"query"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"–ú—É—Ä–æ–º—Å–∫–∏–π –ø—Ä–∏–±–æ—Ä–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–≤–æ–¥ –ê–û"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"boost"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-comment"><span class="hljs-comment">"operator"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"or"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"minimum_should_match"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"70%"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"fuzziness"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"AUTO"</span></span> } } }, { <span class="hljs-comment"><span class="hljs-comment">"match"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"manufacturer"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"query"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"–íalenta –§armacevtika –û–ê–û"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"boost"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-comment"><span class="hljs-comment">"operator"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"or"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"minimum_should_match"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"70%"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"fuzziness"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"AUTO"</span></span> } } } ] } } ] } }, <span class="hljs-comment"><span class="hljs-comment">"highlight"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"fields"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"name"</span></span>: {} } }, <span class="hljs-comment"><span class="hljs-comment">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> }</code> </pre> <br>  At the exit, we get the id of the goods, as well as their names + score for analytics, with highlighted fragments. <br><br><ul><li>  <b>Hyoxysone</b> <b>10</b> <b>mg</b> + <b>30</b> <b>mg</b> / <b>g</b> <b>ointment</b> <b>for</b> <b>external</b> <b>use of a</b> <b>tube</b> <b>10</b> <b>g</b> - Evaluation by the algorithm: 69.84 </li><li>  <b>HIOXISON</b> <b>ointment</b> <b>for</b> <b>external</b> <b>use</b> <b>10</b> <b>mg</b> + <b>30</b> <b>mg</b> / <b>g</b> : <b>10</b> <b>g</b> - Evaluation by the algorithm: 49.79 </li></ul><br><h2>  Conclusion </h2><br>  The described method certainly will not give 100% accuracy of comparison, but it will greatly facilitate the process of manual comparison of goods.  Also suitable for tasks that do not require absolute accuracy. <br>  In general, if we improve the search query with the methods of additional heuristics and increasing the number of synonyms, we can achieve a result close to satisfactory. <br>  In addition, the performance tests performed on the old i7, showed good results.  10 search queries in an array of 200,000 products run within a couple of seconds.  Live this example of drugs can be found <a href="https://allrival.com/habr">here</a> . <br><br>  Offer your options, ways of comparison in the comments. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/428814/">https://habr.com/ru/post/428814/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>