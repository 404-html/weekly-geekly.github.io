<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Moving from Ubuntu to Windows 10, Hyper-V and getting rid of the iron router</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having bought a new laptop, I regretfully noticed that my beloved Ubuntu no longer supports the work of the sensors and the fans are constantly buzzin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Moving from Ubuntu to Windows 10, Hyper-V and getting rid of the iron router</h1><div class="post__text post__text-html js-mediator-article">  Having bought a new laptop, I regretfully noticed that my beloved Ubuntu no longer supports the work of the sensors and the fans are constantly buzzing, making the work not comfortable.  At the same time, if you download the pre-installed Windows 10 Pro from the original hard drive, then there is a pleasant silence for the ear.  While it was cool outside (and at home), it was tolerable.  But as the heat came, patience came to an end.  It was decided to migrate to Windows. <br><a name="habracut"></a><br>  In my work, I use numerous virtual machines to build, test, and debug the software being developed.  Windows 10 Pro includes Hyper-V virtualization - once the money is paid, you have to use it!  In Ubuntu, I used libvirt and virtual machines combined into one internal virtual network. <br><br>  Transferring Windows from the original disk to the SSD and transforming the virtual machine images into hyper-v format, with a pain in my heart, I began to master the new operating system. <br><br>  It turned out not so scary!  Virtual desktops were replaced with windows desktops (unfortunately only horizontal), the console replaced the WSL console (Windows Subsystem for Linux), X11 applications were installed and added to VcXsrv autorun, virtual machines started working in Hyper-V, and even OSX was launched. <br><br>  The native terminal was not entirely convenient and without tabs, so it was mercilessly replaced by the xfce4 terminal, which is launched via a shortcut with a hidden console linux window: <br><br><img src="https://habrastorage.org/webt/_b/zv/_m/_bzv_muthimp9okycb35xuvpfry.png" alt="image"><br><br>  An object: <br><br><pre><code>C:\Windows\System32\wscript.exe ./runhidden.vbs bash -c "export DISPLAY=:0.0; export GDK_DPI_SCALE=1.2; cd ~; exec xfce4-terminal"
</code></pre><br>
–ö–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–æ —Å–∫—Ä—ã—Ç—ã–º –æ–∫–Ω–æ–º (—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ä–æ–¥–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ X11 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏), –Ω–∞–≥—É–≥–ª–µ–Ω–Ω–æ–≥–æ –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ä–∞—Ö –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞:<br>
<br>
<pre><code class="vbscript">' Simple command-line help.
select case WScript.Arguments(0)
case "-?", "/?", "-h", "--help"
  WScript.echo "Usage: runHidden executable [...]" &amp; vbNewLine &amp; vbNewLine &amp; "Runs the specified command hidden (without a visible window)."
  WScript.Quit(0)
end select

' Separate the arguments into the executable name
' and a single string containing all arguments.
exe = WScript.Arguments(0)
sep = ""
for i = 1 to WScript.Arguments.Count -1
  ' Enclose arguments in "..." to preserve their original partitioning.
  args = args &amp; sep &amp; """" &amp; WScript.Arguments(i) &amp; """"
  sep = " "
next

' Execute the command with its window *hidden* (0)
WScript.CreateObject("Shell.Application").ShellExecute exe, args, "", "open", 0
</code></pre><br>
–í –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Ç–∞–∫:<br>
<br>
<img src="https://habrastorage.org/webt/by/tx/gn/bytxgn1z4ml4972rbgn8iqd9zy8.png" alt="image"><br>
<br>
–ú–Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —á–∞—Å—Ç–æ –µ–∑–¥–∏—Ç—å, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –ø–æ–µ–∑–¥–æ–∫ —É –º–µ–Ω—è –±—ã–ª –º–µ–ª–∫–∏–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä TP-LINK WR703N –ø—Ä–æ—à–∏—Ç—ã–π OpenWRT:<br>
<br>
<img src="https://habrastorage.org/webt/sa/x3/0v/sax30vjxwdlvnboyclll-0nj9ew.jpeg" alt="image"><br>
<br>
–ù–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã VPN –¥–æ —Ä–∞–±–æ—á–∏—Ö –º–∞—à–∏–Ω –∏ –¥–ª—è –≤—ã—Ö–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. –ï—Å–ª–∏ –µ—Å—Ç—å –∫–∞–±–µ–ª—å, —Ç–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ç–∏ —á–µ—Ä–µ–∑ –∫–∞–±–µ–ª—å, —Ä–∞–∑–¥–∞–µ—Ç –ø–æ WiFi –¥–ª—è –Ω–æ—É—Ç–±—É–∫–∞, —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ WiFi, —Ç–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –Ω–æ—É—Ç–±—É–∫—É —á–µ—Ä–µ–∑ –∫–∞–±–µ–ª—å. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∫–ª–∏–µ–Ω—Ç–∞ WiFi –∏ —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø–∞ –º–æ–∂–Ω–æ, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ —Å–∏–≥–Ω–∞–ª–∞ –ø–∞–¥–∞–µ—Ç, –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∏ –ø–∞–¥–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏.<br>
<br>
–í —Å–≤—è–∑–∏ —Å —ç—Ç–∏–º –≤–æ–∑–Ω–∏–∫–ª–∞ –∏–¥–µ—è –≤–æ–æ–±—â–µ –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç —ç—Ç–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ (–∑–∞–æ–¥–Ω–æ –ø–æ–≤—ã—Å–∏–≤ –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è), –∫–ª—É–±–∫–∞ –ø—Ä–æ–≤–æ–¥–æ–≤ –∏ –±–ª–æ–∫–∞ –ø–∏—Ç–∞–Ω–∏—è, –∑–∞–º–µ–Ω–∏–≤ –µ–≥–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–º. –û—á–µ–≤–∏–¥–Ω–æ, —á—Ç–æ –≤—Å–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã –∏ Windows –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ –æ–¥–Ω—É –ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å. <br>
<br>
–ó–∞–ø—É—Å–∫–∞–µ–º –î–∏—Å–ø–µ—Ç—á–µ—Ä Hyper-V –∏ –≤—ã–±–∏—Ä–∞–µ–º –î–∏—Å–ø–µ—Ç—á–µ—Ä –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–æ–≤. –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –Ω–∞—à—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å. –ù–∞–∑–æ–≤–µ–º –µ–≥–æ LAN Internal:<br>
<br>
<img src="https://habrastorage.org/webt/-s/lq/fm/-slqfmjvqoobpxlv17wqpol0u-c.png" alt="image"><br>
<br>
–í—ã—Ö–æ–¥–∏—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –º—ã –±—É–¥–µ–º —á–µ—Ä–µ–∑ –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–æ–π –∞–¥–∞–ø—Ç–µ—Ä –∏ –µ–∑–µ—Ä–Ω–µ—Ç –∫–∞–±–µ–ª—å. –°–æ–∑–¥–∞–µ–º –¥–≤–∞ –≤–Ω–µ—à–Ω–∏—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–∞, –Ω–µ –∑–∞–±—ã–≤ —É–±—Ä–∞—Ç—å –≥–∞–ª–∫—É ¬´–†–∞–∑—Ä–µ—à–∏—Ç—å —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –æ–±—â–∏–π –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–º—É —Å–µ—Ç–µ–≤–æ–º—É –∞–¥–∞–ø—Ç–µ—Ä—É¬ª ‚Äî –Ω–µ–∑–∞—á–µ–º Windows —Ö–æ–¥–∏—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–∞–ø—Ä—è–º—É—é.<br>
<br>
–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä –¥–ª—è WiFi:<br>
<br>
<img src="https://habrastorage.org/webt/uw/e0/ib/uwe0ibm1xw__cdfjznkxtzio2zo.png" alt="image"><br>
<br>
–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä –¥–ª—è –µ–∑–µ—Ä–Ω–µ—Ç –∫–∞–±–µ–ª—è:<br>
<br>
<img src="https://habrastorage.org/webt/uf/do/hs/ufdohsximsv3dtozw8rso1lyylg.png" alt="image"><br>
<br>
–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ —è –≤—ã–±—Ä–∞–ª —Å–µ—Ä–≤–µ—Ä–Ω—É—é Ubuntu 16.04. –ü–æ—á–µ–º—É 16.04? –ü–æ—Ç–æ–º—É —á—Ç–æ –≤ 18.04 –ø—Ä–æ—Å—Ç—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ –≤ /etc/network/interfaces –∑–∞–º–µ–Ω–∏–ª–∏ –Ω–∞ netplan ‚Äî –Ω–µ —Ö–æ—á—É! –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–µ–µ –Ω–∞—à–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä—ã:<br>
<br>
<img src="https://habrastorage.org/webt/_t/yq/gb/_tyqgbiqmzf_dvk1ailm6skqon4.png" alt="image"><br>
<br>
–í –∑–∞–∫–ª–∞–¥–∫–µ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ª–∏–±–æ –æ—Ç–∫–ª—é—á–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É, –ª–∏–±–æ –≤—ã–±–∏—Ä–∞–µ–º –¶–µ–Ω—Ç—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Microsoft UEFI –∏ —Å—Ç–∞–≤–∏–º –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∫–∞–∫ –æ–±—ã—á–Ω–æ.<br>
<br>
–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏, –∑–∞—Ö–æ–¥–∏–º –≤ —Å–≤–µ–∂–µ—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∫–æ–º–∞–Ω–¥–æ–π ifconfig. –í–Ω–µ—à–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∫–∞–±–µ–ª—å –∏ WiFi –º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å ip –∞–¥—Ä–µ—Å–∞ –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∏ –∞–∫—Ç–∏–≤–Ω—ã. –ï—Å–ª–∏ –∞–¥—Ä–µ—Å–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã, –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —É—Ç–∏–ª–∏—Ç–æ–π –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞:<br>
<code>dhclient eth0 eth1 eth2</code><br>
<br>
–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±—É–¥–µ—Ç –±–µ–∑ –∞–¥—Ä–µ—Å–∞, —Ç–∞–∫ –∫–∞–∫ –≤ –Ω–∞—à–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä dhcp.<br>
–í –º–æ–µ–º —Å–ª—É—á–∞–µ eth0 ‚Äî –≤–Ω–µ—à–Ω–∏–π –µ–∑–µ—Ä–Ω–µ—Ç, eth1 ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å, eth2 ‚Äî –≤–Ω–µ—à–Ω–µ–µ –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–≤ –ø–æ—Ä—è–¥–∫–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ç–µ–≤—ã—Ö –∫–∞—Ä—Ç). –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å —É –Ω–∞—Å –±—É–¥–µ—Ç 192.168.3.0.<br>
<br>
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ –≤ /etc/network/interfaces —Å –ø–æ–º–æ—â—å—é, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ nano:<br>
<br>
<pre><code>source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
allow-hotplug eth0
iface eth0 inet dhcp

# Internal LAN
auto eth1
iface eth1 inet static
        address 192.168.3.1
        netmask 255.255.255.0
        network 192.168.3.0
        broadcast 192.168.3.255

# The primary network interface
allow-hotplug eth2
iface eth2 inet dhcp
</code></pre><br>
–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –∏ –∑–∞—Ö–æ–¥–∏–º –Ω–∞ –Ω–µ–≥–æ –æ–ø—è—Ç—å. –¢–µ–ø–µ—Ä—å –≤—Å–µ —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –∞–¥—Ä–µ—Å–∞ (–≤–Ω–µ—à–Ω–∏–µ –µ—Å–ª–∏ –∏–º–µ—é—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ).<br>
<br>
–ù–∞—Å—Ç—Ä–æ–π–∫–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ—Å–≤—è—â–µ–Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π –∏ –∏–º–µ–µ—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ–±–µ–∂–∏–º—Å—è –±—ã—Å—Ç—Ä–æ –ø–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ.<br>
<br>
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –Ω–∞–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:<br>
sudo apt install dnsmasq iptables-persistent netfilter-persistent openvpn<br>
<br>
–†–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ—Å—ã–ª–∫—É ip –ø–∞–∫–µ—Ç–æ–≤:<br>
<br>
<pre><code class="bash">cat &gt; /etc/sysctl.d/10-forwarding.conf 
net.ipv4.ip_forward=1
</code></pre><br>
–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–µ–∂—Å–µ—Ç–µ–≤–æ–π —ç–∫—Ä–∞–Ω:<br>
<br>
<pre><code>cat &gt; /etc/iptables/rules.v4
# Generated by iptables-save v1.6.0 on Fri Jun 22 11:13:10 2018
*nat
:PREROUTING ACCEPT [2901:568651]
:INPUT ACCEPT [707:80315]
:OUTPUT ACCEPT [445:30025]
:POSTROUTING ACCEPT [14:1200]
-A POSTROUTING -o eth0 -j MASQUERADE
-A POSTROUTING -o eth2 -j MASQUERADE
-A POSTROUTING -o tun+ -j MASQUERADE
COMMIT
# Completed on Fri Jun 22 11:13:10 2018
# Generated by iptables-save v1.6.0 on Fri Jun 22 11:13:10 2018
*filter
:INPUT ACCEPT [57264:68964200]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [44820:7558046]
-A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i eth1 -o tun+ -j ACCEPT
COMMIT
# Completed on Fri Jun 22 11:13:10 2018
</code></pre><br>
–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º dhcp —Å–µ—Ä–≤–µ—Ä –∏ —Å–µ—Ä–≤–µ—Ä –∏–º–µ–Ω:<br>
<br>
<pre><code>cat &gt; /etc/dnsmasq.d/router.conf 
dhcp-authoritative
domain-needed
localise-queries
read-ethers
bogus-priv
expand-hosts
local-service
domain=lan
server=/lan/
dhcp-leasefile=/tmp/dhcp.leases

interface=eth1
dhcp-range=lan,192.168.3.100,192.168.3.249,255.255.255.0,12h
</code></pre><br>
–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∏ –ø–æ–ª—É—á–∞–µ–º —Ä–∞–±–æ—Ç–∞—é—â–∏–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –¥–ª—è Windows –∏ –¥—Ä—É–≥–∏—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω! <br>
<br>
<img src="https://habrastorage.org/webt/eu/nu/pd/eunupdout4qw9horqictv4iguvc.png" alt="image"><br>
<br>
–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–µ openvpn –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–µ–º—Å—è –∂–∏–∑–Ω—å—é –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∂–µ–ª–µ–∑–æ–∫ –∏ –∫–∞–±–µ–ª–µ–π.<br>
<br>
–ù–æ –ø–æ–∑–≤–æ–ª—å—Ç–µ, —Å–ø—Ä–æ—Å–∏—Ç–µ –≤—ã, –∞ –∫–∞–∫ –∂–µ –±—ã—Ç—å —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º –∏ –¥—Ä—É–≥–∏–º–∏ –≥–∞–¥–∂–µ—Ç–∞–º–∏? <br>
<br>
–ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ Windows 10 –ú–æ–±–∏–ª—å–Ω—ã–π —Ö–æ—Ç—Å–ø–æ—Ç! –ù–æ –Ω–µ –≤—Å–µ —Ç–∞–∫ –ø—Ä–æ—Å—Ç–æ. –ú–æ–±–∏–ª—å–Ω—ã–π —Ö–æ—Ç—Å–ø–æ—Ç –Ω–µ —Ö–æ—á–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –Ω–∞—à–µ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏! –ù–µ–∑–∞–¥–∞—á–∞‚Ä¶<br>
<br>
<img src="https://habrastorage.org/webt/gt/pw/gl/gtpwglwzawhwizzfhy6yuf4jwju.png" alt="image"><br>
<br>
–ü–æ–≥—É–≥–ª–∏–≤ –Ω–∞–º–µ—Ç–∏–≤—à—É—é—Å—è –ø—Ä–æ–±–ª–µ–º—É, –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–π —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞. –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤—Å–µ –æ–Ω–∏ –±—ã–ª–∏ –ø–ª–∞—Ç–Ω—ã–µ. –ë—ã–ª–æ —Ä–µ—à–µ–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –ø–ª—é—à–∫–∞–º–∏, –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –∏ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∫–æ–¥–æ–º.<br>
<br>
–ü–æ–º—É—á–∏–≤—à–∏—Å—å –Ω–µ–¥–µ–ª—é, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—ã–ª–æ –Ω–∞–ø–∏—Å–∞–Ω–æ (–∏ –∑–∞–æ–¥–Ω–æ –æ—Å–≤–æ–µ–Ω —Ä–∞–Ω–µ–µ –Ω–µ –∏–∑–≤–µ–¥–∞–Ω–Ω—ã–π –∑–≤–µ—Ä—å ‚Äî Visual Studio):<br>
<br>
<img src="https://habrastorage.org/webt/yq/w9/0d/yqw90do8yfntfel9p_9batr8tb8.png" alt="image"><br>
<br>
–ö—Ä–æ–º–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É, –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–∫—É –ø–æ –∑–∞–ø—É—Å–∫—É –∏ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.<br>
<br>
–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ <a href="https://github.com/pdaxrom/NoWiFi">github</a>.<br>
–î–ª—è —Ç–µ—Ö, –∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –∏–ª–∏ –∫–æ–º—É –ª–µ–Ω—å —Å–æ–±–∏—Ä–∞—Ç—å –∏–∑ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –±–µ–∑ —Å–º—Å –∏ –≤—Å—è–∫–æ–π —Ä–µ–∫–ª–∞–º—ã) –¥–æ—Å—Ç—É–ø–Ω–æ –≤ Windows –ú–∞–≥–∞–∑–∏–Ω–µ <a href="https://www.microsoft.com/ru-ru/p/nowifi/9nk0dst7hzx5">NoWiFi</a>.<br>
<br>
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ –±—ã–ª–∞ —Ä–µ—à–µ–Ω–∞, —Å—Ç–∞—Ä—ã–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –Ω–∞ –ø–µ–Ω—Å–∏—é, –∞ –≤ —Ä—é–∫–∑–∞–∫–µ –æ—Å–≤–æ–±–æ–¥–∏–ª–æ—Å—å –º–µ—Å—Ç–æ!<br>
<br>
–ù–∞ —ç—Ç–æ–º —É –º–µ–Ω—è –≤—Å–µ, –≤—Å–µ–º —Å–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ –∏ —Ç–µ—Ä–ø–µ–Ω–∏–µ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Å—Ç–æ–ª—å –Ω—É–¥–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞!</div><p>Source: <a href="https://habr.com/ru/post/429856/">https://habr.com/ru/post/429856/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>