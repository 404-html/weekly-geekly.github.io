<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Offline JavaScript Broker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my project, I needed a functional that would allow not to lose the entered data, in case of internet connection interruption, and I came up with a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Offline JavaScript Broker</h1><div class="post__text post__text-html js-mediator-article">  In my project, I needed a functional that would allow not to lose the entered data, in case of internet connection interruption, and I came up with a very simple ‚ÄúBroker‚Äù, which allowed not to lose data when the connection was lost, and send them when the connection was restored again.  Perhaps ‚ÄúBroker‚Äù is not a very good name for him, but do not judge strictly.  I want to share, maybe someone will be useful. <br><a name="habracut"></a><br><h2>  about the project </h2><br>  My project is designed for cost accounting and income, or as a simple version of home bookkeeping.  It was created as a progressive web application, so that it would be convenient to use it on mobile devices, as well as to open up the possibilities of push notifications, access the camera for reading bar codes, and the like.  There is a similar mobile application, called ZenMoney, but I wanted something of my own and in my own way. <br><br><h2>  The emergence of ideas </h2><br>  I try to keep track of expenses and incomes clearly, but since it is often forgotten to bring in the necessary positions, especially with regard to cash, I have to do it almost as soon as the ‚Äútransaction‚Äù occurred.  Sometimes I entered data in public transport, such as the subway, where connection loss often occurs even in spite of the widespread Wi-Fi network.  It was a shame that everything hangs up and nothing happens, and then the data is simply lost. <br><br>  The idea came from the use of a queue broker, such as RabbitMQ.  Of course, I have a simpler and less functional solution, but there is something similar to its principles.  I thought that you can save everything, for example, in Cache or LocalStorage in the form of an object with a queue of "unsatisfied" requests, and when a connection appears, calmly execute them.  Of course, they are not executed in the order of turn, which is even better due to asynchronous processing of requests in the JS language, given that you have only one ‚Äúsubscriber‚Äù.  I faced some difficulties, maybe even the implementation of this all will seem a little curve, but this is a working solution.  Of course, it can be improved, but for the time being I will describe the existing ‚Äúraw‚Äù but working version. <br><br><h2>  Getting to the development </h2><br>  The first thing I thought about was where to store data in the absence of a connection?  The service-server imposed on me PWA, works well with the cache, but is it wise to use the cache ?!  Difficult question, I will not go into it.  In general, I decided that LocalStorage is better suited to me.  Since LocalStorage stores values ‚Äã‚Äãof type key: value, the object had to be added as a Json string.  In my project for external development, I added, in the folder with classes, a directory called QueueBroker <br><br><div class="spoiler">  <b class="spoiler_title">File structure</b> <div class="spoiler_text"><code>/**----**/ <br> ‚îú‚îÄ‚îÄ app.js <br> ‚îú‚îÄ‚îÄ bootstrap.js <br> ‚îú‚îÄ‚îÄ classes <br> ‚îÇ  ‚îî‚îÄ‚îÄ QueueBroker <br> ‚îÇ  ‚îú‚îÄ‚îÄ index.js <br> ‚îÇ  ‚îî‚îÄ‚îÄ Library <br> ‚îÇ  ‚îú‚îÄ‚îÄ Broker.js <br> ‚îÇ  ‚îî‚îÄ‚îÄ Storage.js <br> ‚îú‚îÄ‚îÄ components <br> /**----**/ <br></code> <br></div></div><br>  My project is made in the Laravel + VueJs stack, so a certain dependency of the file structure is required.  I do not know how in such cases it is correct to call your own directories for classes, therefore I did so. <br><br>  The index file is created to simply connect the modules from the nested Library.  It may not be a very elegant solution, but I wanted to make it so that if I suddenly changed my mind about using LocalStorage, I would write another class for Storage with the same methods, pass it to the broker's designer, and without changing anything I would use another storage. <br><br><div class="spoiler">  <b class="spoiler_title">index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Broker = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./Library/Broker'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Storage = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./Library/Storage'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.Broker = Broker; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.Storage = Storage;</code> </pre><br></div></div><br>  This method allows you to connect only those libraries that I need in my scripts, for example, if I need both: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Storage, Broker} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../classes/QueueBroker/index'</span></span>;</code> </pre><br>  To make it easy for me to change the storage class, I made a semblance of the constructor for the Broker class, in which the Storage object could be passed as an argument, as long as it has the necessary functions.  I know that on ES6 I could write class and constructor, but decided to do it the old way - prototype.  Comments will write directly on the code: <br><br><div class="spoiler">  <b class="spoiler_title">Broker.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> axios = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'axios'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è axios /* –≠—Ç–æ –∏ –µ—Å—Ç—å –ø–æ–¥–æ–±–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞. –ü—Ä–µ—Ñ–∏–∫—Å –Ω—É–∂–µ–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö front-end –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */ function Broker(storage, prefix='storageKey') { this.storage = storage; this.prefix = prefix; /* –ï—Å–ª–∏ –Ω–∞—à –±—Ä–æ–∫–µ—Ä –ø–æ–∫–∞ –ø—É—Å—Ç–æ–π, –º—ã –∑–∞–≥–æ–Ω–∏–º –≤ –Ω–µ–≥–æ –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç. –ì–ª–∞–≤–Ω–æ–µ —á—Ç–æ–±—ã storage —Å —Ñ—É–Ω–∫—Ü–∏–µ–π add —É–º–µ–ª –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ json */ if(this.storage.get('broker') === null) { this.broker = {}; this.storage.add('broker', this.broker) } else { //–ê –∑–¥–µ—Å—å –Ω–∞–æ–±–æ—Ä–æ—Ç, Storage –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –∏–∑ Json –æ—Ç–¥–∞—Ç—å –Ω–∞–º –æ–±—ä–µ–∫—Ç –∫–æ—Ç–æ—Ä—ã–π –º—ã –∑–∞–ø–∏—à–µ–º –≤ —Å–≤–æ–π—Å—Ç–≤–æ –Ω–∞—à–µ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ this.broker = this.storage.getObject('broker'); } }; //–ü—Ä–æ—Å—Ç–æ —Å—á–µ—Ç—á–∏–∫, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–∂–∏–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä Broker.prototype.queueCount = function () { return Object.keys(this.broker).length; }; //–ú–µ—Ç–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è "–Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ–≥–æ" –∑–∞–ø—Ä–æ—Å–∞ –≤ –Ω–∞—à Storage, —Å –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ–º –∫–ª—é—á–∞ Broker.prototype.saveToStorage = function (method, url, data) { let key = this.prefix + '_' + (Object.keys(this.broker).length + 1); this.broker[key] = {method, url, data}; //–ö—Å—Ç–∞—Ç–∏ –∑–¥–µ—Å—å —Ç–æ–∂–µ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ –∞ –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤—Å–µ –≤ broker, –Ω–æ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –ø—Ä–∏–º–µ—Ä–∞ —Ä–µ—à–∏–ª –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–∞–∫ this.storage.add('broker', this.broker); }; //–≠—Ç–æ –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ, –∫–æ–≥–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ Broker.prototype.run = function () { for (let key in this.broker) { this.sendToServer(this.broker[key], key) } } /* –ú–µ—Ç–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –ù–∞–º –Ω—É–∂–µ–Ω –æ–±—ä–µ–∫—Ç —Å –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –≤ —Å–µ–±–µ method, url –∏ data, –∞ —Ç–∞–∫ –∂–µ –∫–ª—é—á —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –Ω–∞—à–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –ø–æ –Ω–µ–º—É, –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ */ Broker.prototype.sendToServer = function (object, brokerKey) { axios({ method: object.method, url: object.url, data: object.data, }) .then(response =&gt; { if(response.data.status == 200) { //–£–¥–∞–ª—è–µ–º –æ–±—ä–µ–∫—Ç –ø–æ –∫–ª—é—á—É, –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ delete this.broker[brokerKey]; //–ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –æ–±—ä–µ–∫—Ç this.storage.add('broker', this.broker); } else { //–æ—Å—Ç–∞–≤–∏–º –¥–ª—è –¥–µ–±–∞–≥–∞ ;-) console.log(response.data) } }) .catch(error =&gt; { /* –ù—É –∏ –∫–æ–Ω—á–µ–Ω–æ –ø–æ—Å–ª–µ –≤—Å–µ—Ö —É—Å–ø–µ—à–Ω—ã—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π —Å–¥–µ–ª–∞–µ–º –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç–ª–æ–≤ –æ—à–∏–±–æ–∫, –Ω–æ –Ω–µ –≤ —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–∏ */ }); }; //–ù–µ –∑–∞–±—ã–≤–∞–µ–º —Å–¥–µ–ª–∞—Ç—å export module.exports = Broker;</span></span></code> </pre><br></div></div><br>  Next you need the Storage object itself, which will successfully save and retrieve everything from the storage. <br><br><div class="spoiler">  <b class="spoiler_title">Storage.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–∏—Ç—å debug-—Ä–µ–∂–∏–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ function Storage(debug) { if(debug === true) { this.debugMode = true; } this.storage = window.localStorage; }; //–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥, –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ –≤ Json –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –µ–≥–æ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Storage.prototype.addObjectToStorage = function (key, object) { this.storage.setItem(key, JSON.stringify(object)); }; //–î–ª—è –∑–∞–ø–∏—Å–∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—á–∏—Å–µ–ª, –±—É–ª–µ–≤—ã—Ö –∏ —Å—Ç—Ä–æ–∫) Storage.prototype.addStringToStorage = function (key, value) { this.storage.setItem(key, value); }; //–ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ Storage.prototype.get = function (key) { return this.storage.getItem(key); }; //–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –∏–∑ –Ω–∞—à–µ–≥–æ Json –≤–Ω—É—Ç—Ä–∏, –∫–æ—Ç–æ—Ä—ã–π –º—ã –∑–∞–ø–∏—Å–∞–ª–∏ –¥—Ä—É–≥–∏–º –º–µ—Ç–æ–¥–æ–º –≤—ã—à–µ Storage.prototype.getObject = function (key) { try { return JSON.parse(this.storage.getItem(key)); } catch (e) { this._debug(e); this._debug(key + ' = ' + this.storage.getItem(key)); return false; } }; /* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ –∑–∞–º–æ—Ä–∞—á–∏–≤–∞—Ç—å—Å—è —Å –º–µ—Ç–æ–¥–∞–º–∏, –æ—Ç–¥–∞–µ–º –µ–º—É, –∞ –æ–Ω —É–∂–µ —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞–∫ –µ–≥–æ –∑–∞–ø–∏—Å–∞—Ç—å, —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ Json –∏–ª–∏ –∑–∞–ø–∏—Å–∞—Ç—å –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ */ Storage.prototype.add = function (key, value) { try { if(typeof value === 'object') { this.addObjectToStorage(key, value); } else if (typeof value === 'string' || typeof value === 'number') { this.addStringToStorage(key, value); } else { //–ù–µ–±–æ–ª—å—à–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–∏–ø—ã this._debug('2 parameter does not belong to a known type') } return this.storage; } catch (e) { //–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è, –Ω–æ –Ω–∞–º –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, –µ—Å–ª–∏ —Ç–∞–∫–æ–µ —Å–ª—É—á–∏—Ç—Å—è if (e === QUOTA_EXCEEDED_ERR) { this._debug('LocalStorage is exceeded the free space limit') } else { this._debug(e) } } }; //–û—á–∏—Å—Ç–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ Storage.prototype.clear = function () { try { this.storage.clear(); return true; } catch (e) { this._debug(e) return false; } }; //–£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ Storage.prototype.delete = function(key) { try { this.storage.removeItem(key); return true; } catch (e) { this._debug(e) return false; } }; //–ú–∞–ª–µ–Ω—å–∫–∏–π –¥–µ–±–∞–≥–µ—Ä, –∫–æ—Ç–æ—Ä—Ä—ã–π –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ —Ö–æ–¥—É Storage.prototype._debug = function(error) { if(this.debugMode) { console.error(error); } return null; }; //–ù–µ –∑–∞–±—ã–≤–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å module.exports = Storage;</span></span></code> </pre><br></div></div><br>  When all the above will be done, it can be used at your discretion, I use it like this: <br><br><div class="spoiler">  <b class="spoiler_title">Use when saving</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//—ç—Ç–æ –≤–Ω—É—Ç—Ä–∏ –æ–±—ä–µ–∫—Ç–∞ Vue (methods) /*----*/ //–ó–¥–µ—Å—å –∏ –æ–±—ä—è–≤–ª—è–µ–º –Ω–∞—à –±—Ä–æ–∫–µ—Ä –∏ Storage –¥–ª—è –Ω–µ–≥–æ sendBroker(method, url, data) { let storage = new Storage(true); let broker = new Broker(storage, 'fundsControl'); broker.saveToStorage(method, url, data); }, //–ó–¥–µ—Å—å –≤—ã–ø–æ–ª–Ω—è–µ–º —Å–≤–æ–π –æ–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å fundsSave() { let url = '/pa/funds'; let method = ''; if(this.fundsFormType === 'create') { method = 'post'; } else if(this.fundsFormType === 'update') { method = 'put'; } else if(this.fundsFormType === 'delete') { method = 'delete'; } this.$store.commit('setPreloader', true); axios({ method: method, url: url, data: this.fundsFormData, }) .then(response=&gt; { if(response.data.status == 200) { this.fundsFormShow = false; this.getFunds(); this.$store.commit('setPreloader', false); } else { this.$store.commit('AlertError', '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞'); } }) //–ê –∫–∞–∫ —Ä–∞–∑ –∑–¥–µ—Å—å –æ—Ç–ª–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—à—É –æ—à–∏–±–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è .catch(error =&gt; { this.$store.commit('setAlert', { type: 'warning', status: true, message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –û–¥–Ω–∞–∫–æ, –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç —É—Ä–µ—Ä—è–Ω—ã –∏ –±—É–¥—É—Ç –∑–∞–ø–∏—Å–∞–Ω—ã, –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è' } ); this.fundsFormShow = false; this.$store.commit('setPreloader', false); //–ò –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –Ω–∞—à "–Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω—ã–π" –∑–∞–ø—Ä–æ—Å this.sendBroker(method, url, this.fundsFormData); console.error(error); }); },</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Use when reconnecting</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//–≠—Ç–æ –∫–æ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ Vue /*--*/ methods: { /*----*/ /* –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –Ω–∞—à–µ–≥–æ –±—Ä–æ–∫–µ—Ä–∞, —Å —Ç–µ–º–∏ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, —á—Ç–æ–±—ã –º—ã –∑–Ω–∞–ª–∏, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ–º —Å —Ç–µ–º–∏ –∂–µ –∫–ª—é—á–∞–º–∏, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –∑–∞–ø–∏—Å—ã–≤–∞–ª–∏ –≤ –±—Ä–æ–∫–µ—Ä */ brokerSendRun() { let storage = new Storage(true); let broker = new Broker(storage, 'fundsControl'); //–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å —á—Ç–æ-—Ç–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ if(broker.queueCount() &gt; 0) { //–ó–∞–ø—É—Å–∫–∞–µ–º –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç broker.run(); //–í—ã–≤–æ–¥–∏–º –æ–±—â–∏–π –∞–ª–µ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º this.$store.commit('setAlert', {type: 'info', status: true, message: '–ï—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Å–µ–π—á–∞—Å'}); } } } /*---*/ /* –ù—É –∏ –≤—ã–∑—ã–≤–∞–µ–º –Ω–∞—à –º–µ—Ç–æ–¥, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –∫–∞–∫ —Ä–∞–∑ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø–æ—Å–ª–µ –æ—Ç–æ—Ä–≤–∞–≤—à–µ–≥–æ—Å—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∏ —É–∂ –µ—Å–ª–∏ –æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è, —Ç–æ –∏ –Ω–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä */ mounted() { this.brokerSendRun(); } /*---*/</span></span></code> </pre><br></div></div><br><h3>  PS </h3><br>  I find it difficult to talk about the code, so I tried to provide the code given in the examples with detailed comments as much as possible.  If you have ideas for improving this solution or for improving this article, I will be glad to see them in the comments.  I took examples from my own project on Vue, explaining this in order to make it clear why my methods are so called and why I refer to them through <b>this</b> .  I do not do this article on Vue, so I don‚Äôt give other component code, I leave it just for understanding. </div><p>Source: <a href="https://habr.com/ru/post/428980/">https://habr.com/ru/post/428980/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>