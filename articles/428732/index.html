<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make an extension for PHP7 harder than "hello, world", and not become a red-eyed. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Summary of the first part 
 In the first part, I made a blank of the extension, made it work correctly in IDE Clion, wrote the analog function my_arra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <div class="page-header-logo-container"></div>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make an extension for PHP7 harder than "hello, world", and not become a red-eyed. Part 2</h1><div class="post__text post__text-html js-mediator-article"><h2>  Summary of the first part </h2><br>  In the <a href="https://habr.com/post/428626/">first part,</a> I made a blank of the extension, made it work correctly in IDE Clion, wrote the analog function my_array_fill () and checked its efficiency in php. <br><br><h2>  Now what? </h2><br>  Now I will <a href="https://github.com/legale/libtrie">fill</a> in the <a href="https://github.com/legale/libtrie">libtrie</a> library <a href="https://github.com/legale/libtrie">code</a> in our extension. <br><br>  I‚Äôll tell you a little about how you can make old php5 extensions work in php7. <br>  Then I will do a few basic functions from this library in php and check what happened. <br><a name="habracut"></a><br><h2>  Go </h2><br><h3>  Get the libtrie code in our extension </h3><br>  Go to the directory extension <br><br><pre><code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Documents/libtrie/</code> </pre> <br>  Cloning libtrie repository <br><br><pre> <code class="hljs php">git <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> https:<span class="hljs-comment"><span class="hljs-comment">//github.com/legale/libtrie</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/xg/qz/pu/xgqzpu-aaergrdemyad5c7srze0.png"><br><br>  I open the file with the extension code <code>php_libtrie.c</code> and the file with the library code <code>libtrie/src/libtrie.c</code> . <br><br><img src="https://habrastorage.org/webt/mb/xm/-n/mbxm-ni0ebfdytmh4nocds6ilfk.png"><br><br>  I will use the last one to check the names and syntax of functions. <br><br>  I will use the same functions in php as in the library itself. <br>  First of all, we need to include the header file of the library in the code of our extension. <br>  We write in php_libtrie.c: <br><br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"libtrie/src/libtrie.h"</span></span></span></span></code> </pre> <br><h4>  Yatrie_new function </h4><br>  I do the first function that will create a prefix tree.  In the library, it is called <br><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-function">trie_s *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yatrie_new</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max_nodes, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max_refs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max_deallocated_size)</span></span></span><span class="hljs-function"> </span></span>{...}</code> </pre><br>  As can be seen from the code, the function takes 3 numeric arguments as input and returns a pointer to the <code>trie_s</code> structure.  Simply put, returns a link to the created prefix tree. <br><br>  In order to pull out our prefix tree in PHP, PHP has a special data type called resource.  When a function is executed in PHP <br><br><pre> <code class="php hljs">fopen(<span class="hljs-string"><span class="hljs-string">"filename.ext"</span></span>);</code> </pre><br>  Speaking in C, the program asks the operating system to open the specified file, creates a pointer to this file, which is in the form of a resource and returns to the outside in PHP. <br><br>  We will do the same with our tree. <br><br>  Make a function in php_libtrie.c: <br><br><div class="spoiler">  <b class="spoiler_title">Function code</b> <div class="spoiler_text"><pre> <code class="hljs ruby">PHP_FUNCTION (yatrie_new) { <span class="hljs-regexp"><span class="hljs-regexp">/* –≠—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–µ—Ä–µ–≤–æ */</span></span> trie_s *trie; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>—ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ zend_long max_nodes; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª-–≤–æ —É–∑–ª–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤ –Ω–∞—à–µ–º –¥–µ—Ä–µ–≤–µ zend_long max_refs; <span class="hljs-regexp"><span class="hljs-regexp">/* –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª-–≤–æ —Å—Å—ã–ª–æ–∫ –≤ –¥–µ—Ä–µ–≤–µ. * –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏ —Å–ª–æ–≤ –≤ –¥–µ—Ä–µ–≤–æ. –ö–æ–ª-–≤–æ —É–∑–ª–æ–≤ +25% –¥–æ–ª–∂–Ω–æ —Ö–≤–∞—Ç–∞—Ç—å –Ω–∞ –ª—é–±–æ–µ –¥–µ—Ä–µ–≤–æ. * –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–æ–≤–∞—Ä—å —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ OpenCorpora ~3–º–ª–Ω. —Å–ª–æ–≤ —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ 5–º–ª–Ω. —É–∑–ª–æ–≤ –∏ 5–º–ª–Ω. —Å—Å—ã–ª–æ–∫ */</span></span> zend_long max_deallocated_size; <span class="hljs-regexp"><span class="hljs-regexp">/* –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤ –≤ –±–ª–æ–∫–µ —Å—Å—ã–ª–æ–∫ * –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏. –í—Å–µ–≥–æ —É –Ω–∞—Å 96 –±–∏—Ç –≤ –º–∞—Å–∫–µ —É–∑–ª–∞, 1 –±–∏—Ç –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω, –æ—Å—Ç–∞–µ—Ç—Å—è 95. * –ó–Ω–∞—á–∏—Ç –¥–ª—è –ª—é–±–æ–≥–æ —É–∑–ª–∞ —É—á–∞—Å—Ç–æ–∫ –ø–∞–º—è—Ç–∏ –≤ –±–ª–æ–∫–µ —Å—Å—ã–ª–æ–∫ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ 95, —á—Ç–æ –∑–Ω–∞—á–∏—Ç, * —á—Ç–æ –º–∞–∫—Å. —Ä–∞–∑–º–µ—Ä –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ —Å—Å—ã–ª–æ–∫ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ 94. */</span></span> /<span class="hljs-regexp"><span class="hljs-regexp">/–ø–æ–ª—É—á–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏–∑ PHP if (zend_parse_parameters(ZEND_NUM_ARGS(), "lll", &amp;max_nodes, &amp;max_refs, &amp;max_deallocated_size) == FAILURE) { RETURN_FALSE; } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—Å–æ–∑–¥–∞–µ–º –¥–µ—Ä–µ–≤–æ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –µ–≥–æ –∞–¥—Ä–µ—Å –≤ –ø–∞–º—è—Ç–∏ –≤ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–ª—è —ç—Ç–æ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—å trie = yatrie_new((uint32_t)max_nodes, (uint32_t)max_refs, (uint32_t)max_deallocated_size); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å - –∑–∞–≤–µ—Ä—à–∞–µ–º —Ä–∞–±–æ—Ç—É if (!trie) { RETURN_NULL(); } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—Ç—É—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 2 –¥–µ–π—Å—Ç–≤–∏—è /</span></span>* —Ñ—É–Ω–∫—Ü–∏—è zend_register_resource() —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–µ—Å—É—Ä—Å –≤ –Ω–µ–¥—Ä–∞—Ö Zend, * –ø–∏—à–µ—Ç –Ω–æ–º–µ—Ä —ç—Ç–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é le_libtrie, –∞ –º–∞–∫—Ä–æ—Å ZVAL_RES() * —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å –≤ zval return_value *<span class="hljs-regexp"><span class="hljs-regexp">/ ZVAL_RES(return_value, zend_register_resource(trie, le_libtrie)); }</span></span></code> </pre><br></div></div><br>  Now you need to add the created function to the array of extension functions, otherwise the function will not be visible from PHP. <br><br><pre> <code class="hljs lisp">PHP_FE(<span class="hljs-name"><span class="hljs-name">yatrie_new</span></span>, NULL)</code> </pre><br><img src="https://habrastorage.org/webt/2a/vu/qg/2avuqgxgwedjw0jjxrj2r1neaf0.png"><br><br>  To make it quite beautiful, I will add a function declaration to the header file.  This is not necessary because our PHP functions do not interact with each other, but I still prefer to declare all the functions in the header file. <br><br>  Just add the lines: <br><br><pre> <code class="hljs lisp">PHP_FUNCTION(<span class="hljs-name"><span class="hljs-name">confirm_libtrie_compiled</span></span>)<span class="hljs-comment"><span class="hljs-comment">; PHP_FUNCTION(my_array_fill); PHP_FUNCTION(yatrie_new);</span></span></code> </pre>  to the php_libtrie.h file.  Somewhere between: <br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> PHP_LIBTRIE_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PHP_LIBTRIE_H</span></span></code> </pre>  and <br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* PHP_LIBTRIE_H */</span></span></span></span></code> </pre> <br><img src="https://habrastorage.org/webt/uk/jc/sc/ukjcscch9ozcfpoux0ewnn9byp0.png"><br><br><h4>  PHP resource destructor </h4><br>  The created yatrie_new () function creates a tree, and also registers a PHP resource.  Now we need a function that will close the created resource and free the memory occupied by the prefix tree. <br><br><pre> <code class="hljs java"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@brief</span></span></span><span class="hljs-comment"> –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä —Ä–µ—Å—É—Ä—Å–∞, –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥–µ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Ä–µ—Å—É—Ä—Å –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –µ–≥–æ * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> rsrc : zend_resource * —É–∫–∞–∑–∞—Ç–µ–ª—å * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">php_libtrie_dtor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(zend_resource *rsrc TSRMLS_DC)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//—Ç—É—Ç –º—ã –±–µ—Ä–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ trie –∏–∑ —Ä–µ—Å—É—Ä—Å–∞ trie_s *trie = (trie_s *) rsrc-&gt;ptr; //—Ç—É—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å, // –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é –¥–ª—è trie yatrie_free(trie); }</span></span></code> </pre><br>  Since the function is internal to the array of expansion functions, it is not included.  I will add her declaration in php_libtrie.h: <br><br><img src="https://habrastorage.org/webt/z3/nb/nh/z3nbnhwgsndugygpalj3ua-fhoy.png"><br><br>  Now you need to register the created destructor function in PHP.  This is done through a special extension initialization function.  Before that, this function simply returned SUCCESS immediately.  It is necessary to add the destructor registration there. <br><br><pre> <code class="hljs pgsql">//–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –≤ PHP —Ñ—É–Ω–∫—Ü–∏—é –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä –Ω–∞—à–µ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ trie PHP_MINIT_FUNCTION (libtrie) { le_libtrie = zend_register_list_destructors_ex( php_libtrie_dtor, <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, PHP_LIBTRIE_RES_NAME, module_number); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SUCCESS; }</code> </pre><br><img src="https://habrastorage.org/webt/fr/xk/fq/frxkfq1wti5opa7tvq9ed0htgiy.png"><br><br><h4>  Delete tree function </h4><br>  Like the <code>fopen()</code> function has a pair of <code>fclose()</code> , so my tree creation function should have a friend who will balance it. <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="hljs lua">/** * @brief –£–¥–∞–ª—è–µ—Ç –¥–µ—Ä–µ–≤–æ –∏–∑ –ø–∞–º—è—Ç–∏ * @param trie : resource * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>/<span class="hljs-literal"><span class="hljs-literal">false</span></span> : bool */ PHP_FUNCTION (yatrie_free) { zval *resource; //—É–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è zval —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å —Ä–µ—Å—É—Ä—Å–æ–º //–ø–æ–ª—É—á–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç —Ç–∏–ø–∞ —Ä–µ—Å—É—Ä—Å <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, <span class="hljs-string"><span class="hljs-string">"r"</span></span>, &amp;resource) == FAILURE) { RETURN_FALSE; } /* —Ç—É—Ç –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∑–∞–∫—Ä—ã—Ç–∏–µ —Ä–µ—Å—É—Ä—Å–∞, –Ω–∞ –≤—Ö–æ–¥–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è zend_resource, * –∫–æ—Ç–æ—Ä—ã–π —Å–Ω–∞—á–∞–ª–∞ –Ω–∞–¥–æ –¥–æ—Å—Ç–∞—Ç—å –∏–∑ zval. –≠—Ç–æ –∏ –¥–µ–ª–∞–µ—Ç –º–∞–∫—Ä–æ—Å Z_RES_P() */ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (zend_list_close(Z_RES_P(resource)) == SUCCESS) { //–º–∞–∫—Ä–æ—Å –ø–∏—à–µ—Ç <span class="hljs-literal"><span class="hljs-literal">true</span></span> –≤ return_vale –∏ –¥–µ–ª–∞–µ—Ç <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RETURN_TRUE; } //–º–∞–∫—Ä–æ—Å –ø–∏—à–µ—Ç <span class="hljs-literal"><span class="hljs-literal">false</span></span> –≤ return_vale –∏ –¥–µ–ª–∞–µ—Ç <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RETURN_FALSE; }</code> </pre><br></div></div><br>  I add a function to the array of extension functions: <br><br><pre> <code class="hljs lisp">PHP_FE(<span class="hljs-name"><span class="hljs-name">yatrie_free</span></span>, NULL)</code> </pre><br>  I add the function declaration to the header file: <br><br><pre> <code class="hljs lisp">PHP_FUNCTION(<span class="hljs-name"><span class="hljs-name">yatrie_free</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><img src="https://habrastorage.org/webt/vr/hh/2j/vrhh2jigm3obaa9cetb8lsx6bqe.png"><br><br>  As you can see in the screenshot, I added the internal resource name in PHP to the header file, as well as the PHP5 macros, which for some reason were deleted from PHP7.  I do not use them, but if someone wants with them, you can easily build a PHP5 extension on PHP7. <br><br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PHP_LIBTRIE_VERSION </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"0.1.0"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Replace with version number for your extension */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PHP_LIBTRIE_RES_NAME </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"libtrie data structure"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* PHP resource name */</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//previously (php5) used MACROS #define ZEND_FETCH_RESOURCE(rsrc, rsrc_type, passed_id, default_id, resource_type_name, resource_type) \ (rsrc = (rsrc_type) zend_fetch_resource(Z_RES_P(*passed_id), resource_type_name, resource_type)) #define ZEND_REGISTER_RESOURCE(return_value, result, le_result) ZVAL_RES(return_value,zend_register_resource(result, le_result))</span></span></span></span></code> </pre><br><h4>  Function add words to trie </h4><br>  Now we will make the function of adding a word to the prefix tree. <br><br><ol><li><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="hljs ruby">/** * @brief –î–æ–±–∞–≤–ª—è–µ—Ç –≤ trie —Å–ª–æ–≤–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç node_id –ø–æ—Å–ª–µ–¥–Ω–µ–π –±—É–∫–≤—ã –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞ * @param trie : resource * @param word : string * @return node_id : int *<span class="hljs-regexp"><span class="hljs-regexp">/ PHP_FUNCTION (yatrie_add) { trie_s *trie; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—É–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è –¥–µ—Ä–µ–≤–∞ zval *resource; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—É–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è zval —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å —Ä–µ—Å—É—Ä—Å–æ–º unsigned char *word = NULL; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—É–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è —Å—Ç—Ä–æ–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º–æ–≥–æ —Å–ª–æ–≤–∞ size_t word_len; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–¥–ª–∏–Ω–∞ —Å–ª–æ–≤–∞ word uint32_t node_id; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/id –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É–∑–ª–∞, –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞ /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–ø–æ–ª—É—á–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "rs", &amp;resource, &amp;word, &amp;word_len) == FAILURE) { RETURN_FALSE } /</span></span>*–ø–æ–ª—É—á–∞–µ–º —Ä–µ—Å—É—Ä—Å –∏–∑ –Ω–µ–¥—Ä PHP, —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç: * <span class="hljs-number"><span class="hljs-number">1</span></span> –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º —Å–∞–º —Ä–µ—Å—É—Ä—Å PHP (–Ω–µ zval, –∞ –∏–º–µ–Ω–Ω–æ —Ä–µ—Å—É—Ä—Å), * <span class="hljs-number"><span class="hljs-number">2</span></span> –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –∏–º—è —Ä–µ—Å—É—Ä—Å–∞ * —è —É—Å—Ç–∞–Ω–æ–≤–∏–ª –µ–≥–æ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –≤ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω–æ–º —Ñ–∞–π–ª–µ * <span class="hljs-number"><span class="hljs-number">3</span></span> –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º —á–∏—Å–ª–æ–≤–æ–π id —Ä–µ—Å—É—Ä—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ø—Ä–∏—Å–≤–æ–µ–Ω –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–∞ * –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å —Ç–∏–ø–∞ void *, –ø–æ—ç—Ç–æ–º—É –Ω–∞–¥–æ –µ–≥–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Ç–∏–ø—É trie_s * * –í PHP5 –≤ —ç—Ç–æ–º –º–µ—Å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –º–∞–∫—Ä–æ—Å ZEND_FETCH_RESOURCE(), –∫–æ—Ç–æ—Ä—ã–π –ø–æ—á–µ–º—É-—Ç–æ —Ä–µ—à–∏–ª–∏ —É–±—Ä–∞—Ç—å –≤ PHP7. *<span class="hljs-regexp"><span class="hljs-regexp">/ trie = (trie_s *) zend_fetch_resource(Z_RES_P(resource), PHP_LIBTRIE_RES_NAME, le_libtrie); /</span></span>* –¥–æ–±–∞–≤–∏–º —Å–ª–æ–≤–æ –≤ trie * –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç - —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É –¥–æ–±–∞–≤–ª—è–µ–º–æ–≥–æ —Å–ª–æ–≤–∞ * –≤—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç - id —É–∑–ª–∞ —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞—á–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, –º—ã –¥–æ–±–∞–≤–ª—è–µ–º —Å –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞ * —Ç—Ä–µ—Ç–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç - —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –Ω–∞—à–µ –¥–µ—Ä–µ–≤–æ. *<span class="hljs-regexp"><span class="hljs-regexp">/ node_id = yatrie_add(word, 0, trie); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–≤–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ RETURN_LONG(node_id); }</span></span></code> </pre><br></div></div><br></li><li>  I add an entry to the array of functions: <br><br><pre> <code class="hljs lisp">PHP_FE(<span class="hljs-name"><span class="hljs-name">yatrie_add</span></span>, NULL)</code> </pre></li><li>  I add the declaration to the header file: <br><br><pre> <code class="hljs lisp">PHP_FUNCTION(<span class="hljs-name"><span class="hljs-name">yatrie_add</span></span>)</code> </pre></li></ol><br><h4>  The function of the withdrawal of all words from the dictionary </h4><br>  Now we will make a function that will select all words from the prefix tree and output them in PHP as an array. <br><br><ol><li><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="hljs ruby">/** * @brief –æ–±—Ö–æ–¥–∏—Ç –≤—Å–µ –≤–µ—Ç–≤–∏ –¥–µ—Ä–µ–≤–∞, –Ω–∞—á–∏–Ω–∞—è —Å –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞, –∏ –≤—ã–≤–æ–¥–∏—Ç –≤ –º–∞—Å—Å–∏–≤ –≤—Å–µ * —Å–ª–æ–≤–∞, –≤—Å—Ç—Ä–µ—á–µ–Ω–Ω—ã–µ –Ω–∞ —Å–≤–æ–µ–º –ø—É—Ç–∏ * @param trie : resource * @param node_id : int * @param head (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) : string —Å—Ç—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç * –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –Ω–∞—á–∞–ª–æ –∫–∞–∂–¥–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞ * @return array *<span class="hljs-regexp"><span class="hljs-regexp">/ PHP_FUNCTION (node_traverse) { trie_s *trie; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—É–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è trie words_s *words; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ª–æ–≤ –∏–∑ trie zval * resource; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—É–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è zval —Ä–µ—Å—É—Ä—Å–∞ zend_long node_id; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–Ω–∞—á–∞–ª—å–Ω—ã–π —É–∑–µ–ª unsigned char *head = NULL; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É –ø—Ä–µ—Ñ–∏–∫—Å size_t head_len; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–¥–ª–∏–Ω–∞ –ø—Ä–µ—Ñ–∏–∫—Å–∞ /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–ø–æ–ª—É—á–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏–∑ PHP if (zend_parse_parameters(ZEND_NUM_ARGS(), "rl|s", &amp;resource, &amp;node_id, &amp;head, &amp;head_len) == FAILURE) { RETURN_NULL(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–≤–æ–∑–≤—Ä–∞—â–∞–µ–º null –≤ —Å–ª—É—á–∞–µ –Ω–µ—É–¥–∞—á–∏ } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–ø–æ–ª—É—á–∏–º –Ω–∞—à–µ –¥–µ—Ä–µ–≤–æ –∏–∑ —Ä–µ—Å—É—Ä—Å–∞ trie = (trie_s *) zend_fetch_resource(Z_RES_P(resource), PHP_LIBTRIE_RES_NAME, le_libtrie); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ª–æ–≤ –∏–∑ trie —Ñ—É–Ω–∫—Ü–∏—è node_traverse() –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ words_s /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–≤—ã–¥–µ–ª–∏–º –ø–∞–º—è—Ç—å –ø–æ–¥ –Ω–µ–µ words = (words_s *) calloc(1, sizeof(words_s)); words-&gt;counter = 0; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—É—Å—Ç–∞–Ω–æ–≤–∏–º —Å—á–µ—Ç—á–∏–∫ —Å–ª–æ–≤ –Ω–∞ 0 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–Ω—É–∂–Ω–∞ –µ—â–µ 1 —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø—Ä–µ—Ñ–∏–∫—Å–∞ string_s *head_libtrie = calloc(1, sizeof(string_s)); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–µ—Å–ª–∏ head –∑–∞–¥–∞–Ω if(head != NULL) { head_libtrie-&gt;length = (uint32_t)head_len; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–ø—Ä–∏—Å–≤–æ–∏–º –¥–ª–∏–Ω—É memcpy(&amp;head_libtrie-&gt;letters, head, head_len); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—Å–∫–æ–ø–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ head_libtrie } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∏–º —Å–ª–æ–≤–∞ –∏–∑ trie node_traverse(words, (uint32_t) node_id, head_libtrie, trie); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º PHP –º–∞—Å—Å–∏–≤, —Ä–∞–∑–º–µ—Ä –≤–æ–∑—å–º–µ–º –∏–∑ —Å—á–µ—Ç—á–∏–∫–∞ —Å–ª–æ–≤ –≤ words array_init_size(return_value, words-&gt;counter); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–¥–æ–±–∞–≤–∏–º —Å–ª–æ–≤–∞ –≤ –º–∞—Å—Å–∏–≤ php while (words-&gt;counter--) { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/–ø–æ—Å–∫–æ–ª—å–∫—É –≤ trie –±—É–∫–≤—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∏–¥–µ –∫–æ–¥–æ–≤, –Ω—É–∂–Ω–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∏—Ö /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—ç—Ç–æ –º–∞—Å—Å–∏–≤ –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞ uint8_t dst[256]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—Ñ—É–Ω–∫—Ü–∏—è –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ libtrie decode_string(dst, words-&gt;words[words-&gt;counter]); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è Zend API, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –º–∞—Å—Å–∏–≤ —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–∏–ø–æ–º php string –∏–∑ —Ç–∏–ø–∞ –°–∏ char * add_next_index_string(return_value, (const char *) dst); } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/—Ç–µ–ø–µ—Ä—å –Ω–∞–¥–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–∞–º—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é –ø–æ–¥ words –∏ head_libtrie free(words); free(head_libtrie); }</span></span></code> </pre><br></div></div></li><li>  I add an entry to the array of functions: <br><br><pre> <code class="hljs lisp">PHP_FE(<span class="hljs-name"><span class="hljs-name">node_traverse</span></span>, NULL)</code> </pre><br></li><li>  I add the declaration to the header file: <br><br><pre> <code class="hljs lisp">PHP_FUNCTION(<span class="hljs-name"><span class="hljs-name">node_traverse</span></span>)</code> </pre><br></li></ol><br><h3>  Extension build </h3><br>  Since the extension now uses files from a third-party library, these files must also be compiled.  I open the config.m4 file and add 2 source libtrie files there: <br><br> <code>libtrie/src/libtrie.c <br> libtrie/src/single_list.c <br></code> <br><br>  Here is the full contents of the file after the changes. <br><br><div class="spoiler">  <b class="spoiler_title">config.m4</b> <div class="spoiler_text"><pre> <code class="bash hljs">PHP_ARG_ENABLE(libtrie, whether to <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> libtrie support, [ --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libtrie Enable libtrie support]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PHP_LIBTRIE</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">"no"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-comment"><span class="hljs-comment"># –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –≤–∫–ª—é—á–∏—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã # PHP_ADD_INCLUDE(libtrie/src/) # –∫–ª—é—á–µ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ PHP_NEW_EXTENSION(libtrie, \ libtrie/src/libtrie.c \ libtrie/src/single_list.c \ php_libtrie.c \ , $ext_shared) # PHP_NEW_EXTENSION(libtrie, php_libtrie.c libtrie/src/libtrie.c libtrie/src/single_list.c, $ext_shared,, -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1) fi</span></span></code> </pre><br></div></div><br><img src="https://habrastorage.org/webt/kc/ti/z5/kctiz5lsns7ey_f37b_qhqn1wp8.png"><br><br>  Now you need to re-do the ./configure script.  I run from the root directory of the extension: <br><br><pre> <code class="bash hljs">phpize &amp;&amp; ./configure</code> </pre><br>  Now I collect the extension: <br><br><pre> <code class="bash hljs">make</code> </pre><br><h3>  We are testing </h3><br>  For the test, it's best to make a php script so that you don‚Äôt have to write a lot to the console  I will do this: <br><br><pre> <code class="bash hljs">nano yatrie_test.php</code> </pre><br>  And this is the contents of the file: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"C–æ–∑–¥–∞–µ–º –¥–µ—Ä–µ–≤–æ –Ω–∞ 500 —É–∑–ª–æ–≤ –∏ 500 —Å—Å—ã–ª–æ–∫\n\n"</span></span>; $trie = yatrie_new(<span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"–ì–æ—Ç–æ–≤–æ!\n –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–≤–∞, —Å–æ—Ö—Ä—è–Ω—è—è id —É–∑–ª–æ–≤ –≤ –º–∞—Å—Å–∏–≤ \$nodes\n"</span></span>; $nodes[] = yatrie_add($trie, <span class="hljs-string"><span class="hljs-string">"—É—Ö"</span></span>); $nodes[] = yatrie_add($trie, <span class="hljs-string"><span class="hljs-string">"—É—Ö–æ"</span></span>); $nodes[] = yatrie_add($trie, <span class="hljs-string"><span class="hljs-string">"—É—Ö–∞"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"–¢—É—Ç —Ö–æ—Ä–æ—à–æ –≤–∏–¥–Ω–æ –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–µ—Ä–µ–≤–æ.\n –ü–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ –∏–∑ 2 –±—É–∫–≤, –ø–æ—ç—Ç–æ–º—É –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–∑–µ–ª 2.\n –í—Ç–æ—Ä–æ–µ —Å–ª–æ–≤–æ –∏–∑ 3 –±—É–∫–≤, –Ω–æ 2 –±—É–∫–≤—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –ø–µ—Ä–≤—ã–º —Å–ª–æ–≤–æ–º,\n –ø–æ—ç—Ç–æ–º—É —Ç–æ–ª—å–∫–æ 1 —É–∑–µ–ª –¥–æ–±–∞–≤–ª–µ–Ω\n"</span></span>; print_r($nodes); print_r(node_traverse($trie, <span class="hljs-number"><span class="hljs-number">0</span></span>)); yatrie_free($trie);</code> </pre><br>  Perform in the console: <br><br><pre> <code class="bash hljs">php -d extension=modules/libtrie.so yatrie_test.php</code> </pre><br>  This is what should happen: <br><br><img src="https://habrastorage.org/webt/ef/io/qf/efioqf0hubn_dhbykzbvcxah12k.png"><br><br>  The resulting extension source code is taken <a href="https://github.com/legale/php-ext-libtrie">from here</a> .  Do not hesitate and put asterisks :-) </div><p>Source: <a href="https://habr.com/ru/post/428732/">https://habr.com/ru/post/428732/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>