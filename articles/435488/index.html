<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Moki, stubs and spies in the Spock Framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Spock provides 3 powerful (but different in essence) tools that simplify writing tests: Mock, Stub and Spy. 



 Quite often, the code that needs to b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <div class="page-header-logo-container"></div>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Moki, stubs and spies in the Spock Framework</h1><div class="post__text post__text-html js-mediator-article"><p>  Spock provides 3 powerful (but different in essence) tools that simplify writing tests: Mock, Stub and Spy. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mp/b1/16/mpb116loygy7rcfeicuihzm8oym.jpeg"></div><br><p>  Quite often, the code that needs to be tested needs to interact with external modules called dependencies (in the original article, the term collaborators is used, which is not very common in the Russian-speaking environment). </p><br><p>  Unit tests are most often developed for testing one isolated class using various mock options: Mock, Stub and Spy.  So the tests will be more reliable and will be less likely to break as the code of dependencies evolves. </p><br><p>  Such isolated tests are less prone to problems when changing the internal details of the implementation of dependencies. </p><br><p>  <em>From the translator:</em> every time I use the Spock Framework to write tests, I feel that I can be mistaken when choosing a method for replacing dependencies.  This article has the shortest possible crib for choosing a mechanism for creating mocks. </p><a name="habracut"></a><br><h2 id="tldr">  TL; DR </h2><br><h3 id="mocks">  Mocks </h3><br><p>  Use Mock to: </p><br><ul><li>  contract verification between code under test and dependencies </li><li>  checks that dependency methods are called the correct number of times </li><li>  checking the correctness of the parameters with which the dependency code is called </li></ul><br><h3 id="stubs">  Stubs </h3><br><p>  Use Stub to: </p><br><ul><li>  providing predefined call results </li><li>  performing predefined actions expected from dependencies, such as throwing exceptions </li></ul><br><h3 id="spies">  Spies </h3><br><p>  Fear Spyware (Spy).  As stated in the Spock documentation: </p><br><blockquote>  Think twice before using this mechanism.  Perhaps you should redesign your solution and reorganize your code. </blockquote><p>  But it just so happens that there are situations when we have to work with legacy code.  Legacy code can be difficult or even impossible to test with mocks and stubs.  In this case, there is only one solution - use Spy. </p><br><p>  It is better to have legacy code covered with tests using Spy than not having any legacy tests. </p><br><p>  Use Spy to: </p><br><ul><li>  testing legacy code that cannot be tested by other methods </li><li>  checks that dependency methods are called the correct number of times </li><li>  validation of transmitted parameters </li><li>  provide a predetermined response to dependencies </li><li>  performing predefined actions in response to calls to dependency methods </li></ul><br><h2 id="mocks-1">  Mocks </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zi/3q/vj/zi3qvjii7ug7tkq4bczo5f-jo7u.jpeg"></div><br><p> The whole power of mocks is manifested when the task of the unit test is to verify the contract between the code being tested and the dependencies.  Let's look at the following example, where we have a <code>FooController</code> controller that uses <code>FooService</code> as a dependency, and test this functionality using mocks. </p><br><p> <code>FooController.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">FooService fooService def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ render fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) } }</code> </pre> <br><p> <code>FooService.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-string"><span class="hljs-string">"Hi ${name}, FooService did something"</span></span> } }</code> </pre> <br><p>  In this scenario, we want to write a test that checks: </p><br><ul><li>  contract between <code>FooController</code> and <code>FooService</code> </li><li>  <code>FooService.doSomething(name)</code> is called the correct number of times. </li><li>  <code>FooService.doSomething(name)</code> is called with the correct parameter </li></ul><br><p>  Take a look at the test: </p><br><p> <code>MockSpec.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> grails.testing.web.controllers.ControllerUnitTest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spock.lang.Specification <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MockSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Specification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerUnitTest</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-string"><span class="hljs-string">"Mock FooService"</span></span>() { given: <span class="hljs-string"><span class="hljs-string">"—Å–æ–∑–¥–∞—ë–º –º–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"</span></span> def fooService = Mock(FooService) and: <span class="hljs-string"><span class="hljs-string">"—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –º–æ–∫–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä"</span></span> controller.fooService = fooService when: <span class="hljs-string"><span class="hljs-string">"–≤—ã–∑—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞"</span></span> controller.doSomething() then: <span class="hljs-string"><span class="hljs-string">"–º–æ–∫ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–∏—Å–ª–∞ –≤—ã–∑–æ–≤–æ–≤ –∏ –∑–Ω–∞—á–µ–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤"</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> * fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) and: <span class="hljs-string"><span class="hljs-string">"–º–æ–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç '–ø—É—Å—Ç–æ–µ' –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - 'null'"</span></span> response.text == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>.toString() } }</code> </pre> <br><p>  The above test creates a mock service: </p><br><pre> <code class="java hljs">def fooService = Mock(FooService)</code> </pre> <br><p>  The test also checks that <code>FooService.doSomething(name)</code> is called once, and the parameter passed to it matches the string <code>"Sally"</code> . </p><br><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> * fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>)</code> </pre> <br><p>  The above code solves 4 important tasks: </p><br><ul><li>  creates mock for <code>FooService</code> </li><li>  makes sure that <code>FooService.doSomething(String name)</code> is called exactly once with the <code>String</code> parameter and the value <code>"Sally"</code> </li><li>  isolates the code under test, replacing the dependency implementation </li></ul><br><h2 id="stubs-1">  Stubs </h2><br><p>  Does the code being tested use dependencies?  Is the purpose of testing to make sure that the code under test works correctly when interacting with dependencies?  Are the results of the dependency method calls the input values ‚Äã‚Äãfor the code under test? </p><br><p>  If the behavior of the code being tested changes depending on the behavior of the dependencies, then you need to use stubs. </p><br><p>  Let's look at the following example with <code>FooController</code> and <code>FooService</code> and test the functionality of the controller using stubs. </p><br><p> <code>FooController.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">FooService fooService def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ render fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) } }</code> </pre> <br><p> <code>FooService.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-string"><span class="hljs-string">"Hi ${name}, FooService did something"</span></span> } }</code> </pre> <br><p>  Test code: </p><br><p> <code>StubSpec.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> grails.testing.web.controllers.ControllerUnitTest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spock.lang.Specification <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StubSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Specification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerUnitTest</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-string"><span class="hljs-string">"Stub FooService"</span></span>() { given: <span class="hljs-string"><span class="hljs-string">"—Å–æ–∑–¥–∞—ë–º —Å—Ç–∞–± —Å–µ—Ä–≤–∏—Å–∞"</span></span> def fooService = Stub(FooService) { doSomething(_) &gt;&gt; <span class="hljs-string"><span class="hljs-string">"Stub did something"</span></span> } and: <span class="hljs-string"><span class="hljs-string">"—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä —Å—Ç–∞–±–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä"</span></span> controller.fooService = fooService when: <span class="hljs-string"><span class="hljs-string">"–≤—ã–∑—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞"</span></span> controller.doSomething() then: <span class="hljs-string"><span class="hljs-string">"—Å—Ç–∞–± –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ"</span></span> <span class="hljs-comment"><span class="hljs-comment">// 1 * fooService.doSomething() // –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–∏—Å–ª–∞ –≤—ã–∑–æ–≤–æ–≤ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –¥–ª—è —Å—Ç–∞–±–æ–≤ response.text == "Stub did something" } }</span></span></code> </pre> <br><p>  You can create a stub like this: </p><br><pre> <code class="java hljs">def fooService = Stub(FooService) { doSomething(_) &gt;&gt; <span class="hljs-string"><span class="hljs-string">"Stub did something"</span></span> }</code> </pre> <br><p>  The above code solves 4 important tasks: </p><br><ul><li>  creates stub <code>FooService</code> </li><li>  makes sure that <code>FooService.doSomething(String name)</code> returns the string <code>"Stub did something"</code> regardless of the parameter passed (so we used the <code>_</code> character) </li><li>  isolates the code under test, replacing the dependency implementation with a stub </li></ul><br><h2 id="spies-1">  Spies </h2><br><p>  Please do not read this section. </p><br><p>  Do not look. </p><br><p>  Skip to the next one. </p><br><p>  Still reading?  Well, well, let's deal with Spy. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b9/sj/lk/b9sjlk13izmu8rbtb4yv4zncwvm.jpeg"></div><br><p>  Do not use spy.  As stated in the Spock documentation: </p><br><blockquote>  Think twice before using this mechanism.  Perhaps you should redesign your solution and reorganize your code. </blockquote><p>  At the same time, there are situations when we have to work with legacy code.  Legacy code can not be tested using mocks or stubs.  In this case, the spy remains the only viable option. </p><br><p>  Spies are different from mocks or stubs, because they do not work as stubs. </p><br><p>  When a dependency is replaced by a mock or a stub, a test object is created, and the real dependency source code is not executed. </p><br><p>  The spy, on the other hand, will execute the main source code of the dependency for which the spy was created, but the spy will allow you to change what the spy returns, and check for method calls, as well as moki and stubs.  (Hence the name Spy). </p><br><p>  Let's take a look at the following <code>FooController</code> example, which uses <code>FooService</code> , and then test the functionality with a spy. </p><br><p> <code>FooController.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">FooService fooService def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ render fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) } }</code> </pre> <br><p> <code>FooService.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-string"><span class="hljs-string">"Hi ${name}, FooService did something"</span></span> } }</code> </pre> <br><p>  Test code: </p><br><p> <code>SpySpec.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> grails.testing.web.controllers.ControllerUnitTest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spock.lang.Specification <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpySpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Specification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerUnitTest</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-string"><span class="hljs-string">"Spy FooService"</span></span>() { given: <span class="hljs-string"><span class="hljs-string">"—Å–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä-—à–ø–∏–æ–Ω"</span></span> def fooService = Spy(FooService) and: <span class="hljs-string"><span class="hljs-string">"—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä"</span></span> controller.fooService = fooService when: <span class="hljs-string"><span class="hljs-string">"–≤—ã–∑—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞"</span></span> controller.doSomething() then: <span class="hljs-string"><span class="hljs-string">"–ø—Ä–æ–≤–µ—Ä—è–µ–º —á–∏—Å–ª–æ –≤—ã–∑–æ–≤–æ–≤ –∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤"</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> * fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) &gt;&gt; <span class="hljs-string"><span class="hljs-string">"A Spy can modify implementation"</span></span> and: <span class="hljs-string"><span class="hljs-string">'—à–ø–∏–æ–Ω –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–µ—Ç–æ–¥–æ–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π'</span></span> response.text == <span class="hljs-string"><span class="hljs-string">"A Spy can modify implementation"</span></span> } }</code> </pre> <br><p>  Creating a spy instance is quite simple: </p><br><pre> <code class="java hljs">def fooService = Spy(FooService)</code> </pre> <br><p>  In the above code, the spy allows us to verify the call to <code>FooService.doSomething(name)</code> , the number of calls and the values ‚Äã‚Äãof the parameters.  Moreover, the spy modifies the implementation of the method to return a different value. </p><br><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> * fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) &gt;&gt; <span class="hljs-string"><span class="hljs-string">"A Spy can modify implementation"</span></span></code> </pre> <br><p>  The above code solves 4 important tasks: </p><br><ul><li>  creates a spy instance for <code>FooService</code> </li><li>  checks interaction with dependencies </li><li>  Checks how the application works according to the specific results of the calls to the dependency method. </li><li>  isolates the code under test, replacing the dependency implementation with a stub </li></ul><br><h2 id="faq">  FAQ </h2><br><p>  <strong>Which option to use: Mock, Stub or Spy?</strong> </p><br><p>  This is a question that many developers face.  This FAQ can help if you are unsure which approach to use. </p><br><p>  <strong>Q:</strong> Is the goal of testing the verification of the contract between the code being tested and the dependencies? </p><br><p>  <strong>A:</strong> If you answered yes, use mock </p><br><p>  <strong>Q:</strong> Is the purpose of testing to make sure that the code under test works correctly when interacting with dependencies? </p><br><p>  <strong>A:</strong> If you answered yes, use Stub </p><br><p>  <strong>Q:</strong> Are the results of the dependency method calls the input values ‚Äã‚Äãfor the code under test? </p><br><p>  <strong>A:</strong> If you answered yes, use Stub </p><br><p>  <strong>Q:</strong> Do you work with Legacy code that is very difficult to test, and you have no options left? </p><br><p>  <strong>A:</strong> Try using spy </p><br><h2 id="kod-primerov">  Code of examples </h2><br><p>  You can find the code for all examples of this article at the link: </p><br><p>  <a href="https://github.com/ddelponte/mock-stub-spy">https://github.com/ddelponte/mock-stub-spy</a> </p><br><h2 id="poleznye-ssylki">  useful links </h2><br><ul><li>  <a href="http://spockframework.org/spock/docs/1.1/all_in_one.html">http://spockframework.org/spock/docs/1.1/all_in_one.html#_interaction_based_testing</a> </li><li>  <a href="https://martinfowler.com/bliki/UnitTest.html">https://martinfowler.com/bliki/UnitTest.html</a> </li><li>  <a href="https://martinfowler.com/articles/mocksArentStubs.html">https://martinfowler.com/articles/mocksArentStubs.html</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/435488/">https://habr.com/ru/post/435488/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>