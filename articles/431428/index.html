<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The complete guide to CMake. Part One: Syntax</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 CMake is an open and cross-platform toolkit designed to automate the testing, compilation, and packaging of C / C ++ projects. Once y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <div class="page-header-logo-container"></div>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The complete guide to CMake. Part One: Syntax</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/lf/se/70/lfse70sjifxiyddiuym73hdvcho.png"></p><br><h1 id="vvedenie">  Introduction </h1><br><p>  <a href="https://cmake.org/">CMake</a> is an open and cross-platform toolkit designed to automate the testing, compilation, and packaging of C / C ++ projects.  Once you have written a small script that everyone understands, you will ensure the same build of your project on any platforms where CMake is available. </p><br><p>  <a href="https://cmake.org/cmake/help/latest/manual/cmake-language.7.html">The CMake language</a> , when translated to a native build file (for example, Makefile or Ninja), defines the process of the entire project management.  At your disposal, from the functional side, there are only commands that can be formed into rather complex structures.  With them we begin. </p><a name="habracut"></a><br><h1 id="zapusk-cmake">  Launch CMake </h1><br><p>  Below are examples of using the CMake language that you should practice using.  Experiment with the source code, changing existing commands and adding new ones.  To run these examples, install CMake from the <a href="https://cmake.org/">official site</a> . </p><br><h1 id="komandy">  Teams </h1><br><p> Commands in CMake are similar to functions in many programming languages.  To call a command, you need to write its name, and then pass arguments surrounded by parentheses to it, separated by space characters.  In the given example, the <a href="https://cmake.org/cmake/help/latest/command/message.html"><code>message</code></a> command is passed six arguments for output to the console: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å "CMake is the most powerful buildsystem!" message("CMake " "is " "the " "most " "powerful " "buildsystem!")</span></span></code> </pre> <br><h1 id="argumenty">  Arguments </h1><br><p>  Arguments, framed in double quotes, allow you to inside yourself to make the screening and substitution of variables.  Unstructured arguments do not allow the production of such things and cannot include the characters <code>()#"\</code> and spaces, but are more convenient to use. Example: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "Hello, my lovely CMake", –æ–¥–∏–Ω —Ç–∞–± –∏ "!": message("Hello, my lovely CMake\t!") # –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "Hello,_my_lovely_CMake!" –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤: message(Hello,_my_lovely_CMake!)</span></span></code> </pre> <br><p>  It is worth noting that the <code>Walk;around;the;forest</code> argument expands to the <code>Walk around the forest</code> list, since any unwrapped argument automatically expands to a list of values ‚Äã‚Äã(provided that the values ‚Äã‚Äãof the original argument are separated by semicolons), but framed in double quotes by the argument of such a transformation does not occur (the semicolon characters simply disappear).  This feature was <a href="https://habr.com/post/431428/">mentioned</a> in the comments. </p><br><h1 id="kommentarii">  Comments </h1><br><p>  Comments begin with a pound sign and end at the end of the line where they were printed.  Text enclosed in comments is ignored by the build system and has no effect on its work.  The examples above also demonstrate the use of comments. </p><br><h1 id="peremennye">  Variables </h1><br><p>  Variables can be defined by calling the <a href="https://cmake.org/cmake/help/latest/command/set.html"><code>set</code></a> command, and removed by calling <a href="https://cmake.org/cmake/help/latest/command/unset.html"><code>unset</code></a> .  You can get the value of a variable using the <code>${VARIABLE}</code> construction.  If the variable is not yet defined and somewhere it was necessary to get its value, then this variable will turn into an empty string.  Example: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é VARIABLE —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º "Mr. Thomas": set(VARIABLE "Mr. Thomas") # –ù–∞–ø–µ—á–∞–µ—Ç "His name is: Mr. Thomas": message("His name is: " ${VARIABLE}) # –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "'BINGO' is equal to: []", —Ç–∞–∫ –∫–∞–∫ "BINGO" –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞: message("'BINGO' is equal to: [${BINGO}]") # –£–¥–∞–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é VARIABLE: unset(VARIABLE)</span></span></code> </pre> <br><h1 id="opcii">  Options </h1><br><p>  CMake supports setting options to be modified by users.  Options are similar to variables and are set by the <a href="https://cmake.org/cmake/help/latest/command/option.html"><code>option</code></a> command, which takes only three arguments: the variable name, the string description of the variable, and the default value of the variable ( <code>ON</code> or <code>OFF</code> ): </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># –ó–∞–¥–∞—Ç—å –æ–ø—Ü–∏—é `USE_ANOTHER_LIBRARY` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º # "Do you want to use an another library?" –∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º "OFF": option(USE_ANOTHER_LIBRARY "Do you want to use an another library?" OFF)</span></span></code> </pre> <br><h1 id="logicheskie-vyrazheniya">  Boolean expressions </h1><br><p>  Before proceeding to the study of conditional operators and cyclic constructions, it is necessary to understand the operation of logical expressions.  Logical expressions are used when checking conditions and can take one of two values: true or false.  For example, the expression <code>52 LESS 58</code> will appeal to the truth, since 52 &lt;58. The expression <code>88 EQUAL 88</code> will turn into the truth, <code>63 GREATER 104</code> will turn into a lie.  You can compare not only numbers, but also strings, versions, files, belonging to the list and regular expressions.  A complete list of logical expressions can be found <a href="https://cmake.org/cmake/help/latest/command/if.html">here</a> . </p><br><h1 id="uslovnye-operatory">  Conditional statements </h1><br><p>  Conditional operators in CMake work exactly like other programming languages.  In this example, only the first conditional operator will work, which checks that 5&gt; 1. The second and third conditions are false, since 5 cannot be less than or equal to one.  Blocks of <a href="https://cmake.org/cmake/help/latest/command/elseif.html"><code>elseif</code></a> and <a href="https://cmake.org/cmake/help/latest/command/else.html"><code>else</code></a> commands are optional, and <a href="https://cmake.org/cmake/help/latest/command/endif.html"><code>endif</code></a> required and signals the completion of previous checks. </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "Of course, 5 &gt; 1!": if(5 GREATER 1) message("Of course, 5 &gt; 1!") elseif(5 LESS 1) message("Oh no, 5 &lt; 1!") else() message("Oh my god, 5 == 1!") endif()</span></span></code> </pre> <br><h1 id="cikly">  Cycles </h1><br><p>  Cycles in CMake are similar to cycles in other programming languages.  In the given example, the value of the variable <code>VARIABLE</code> in <code>Airport</code> , and then the four nested commands are executed sequentially until the value of the variable <code>VARIABLE</code> equals <code>Airport</code> .  The last fourth command <code>set(VARIABLE "Police station")</code> sets the value of the variable to be checked in the <code>Police station</code> , so the cycle will immediately stop before reaching the second iteration.  The <a href="https://cmake.org/cmake/help/latest/command/endwhile.html"><code>endwhile</code></a> command signals the completion of the list of nested loop commands. </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å —Ç—Ä–∏ —Ä–∞–∑–∞ "VARIABLE is still 'Airport'": set(VARIABLE Airport) while(${VARIABLE} STREQUAL Airport) message("VARIABLE is still '${VARIABLE}'") message("VARIABLE is still '${VARIABLE}'") message("VARIABLE is still '${VARIABLE}'") set(VARIABLE "Police station") endwhile()</span></span></code> </pre> <br><p>  This <a href="https://cmake.org/cmake/help/latest/command/foreach.html"><code>foreach</code></a> example works as follows: at each iteration of this cycle, the variable <code>VARIABLE</code> assigned the following value from the list <code>Give me the sugar please!</code>  , and then the <code>message(${VARIABLE})</code> command is executed, which displays the current value of the <code>VARIABLE</code> variable.  When there are no values ‚Äã‚Äãin the list, the loop ends its execution.  The <a href="https://cmake.org/cmake/help/latest/command/endforeach.html"><code>endforeach</code></a> command signals the completion of the list of nested loop commands. </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "Give me the sugar please!" —Å –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫: foreach(VARIABLE Give me the sugar please!) message(${VARIABLE}) endforeach()</span></span></code> </pre> <br><p>  There are 3 more forms of <a href="https://cmake.org/cmake/help/latest/command/foreach.html"><code>foreach</code></a> records.  The first cycle in this example generates integers from 0 to 10 in place of the list, the second cycle generates in the range from 3 to 15, and the third cycle works in a segment from 50 to 90, but in increments of 10. </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "0 1 2 3 4 5 6 7 8 9 10" —Å –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫: foreach(VARIABLE RANGE 10) message(${VARIABLE}) endforeach() # –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "3 4 5 6 7 8 9 10 11 12 13 14 15" —Å –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫: foreach(VARIABLE RANGE 3 15) message(${VARIABLE}) endforeach() # –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "50 60 70 80 90" —Å –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫: foreach(VARIABLE RANGE 50 90 10) message(${VARIABLE}) endforeach()</span></span></code> </pre> <br><h1 id="funkcii-i-makrosy">  Functions and Macros </h1><br><p>  The CMake syntax allows you to define your own commands that can be called exactly as built-in commands.  The following example demonstrates the use of functions and macros: a function and a macro are first defined with their own commands, and when they are called, their commands are executed sequentially. </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ "print_numbers": function(print_numbers NUM1 NUM2 NUM3) message(${NUM1} " " ${NUM2} " " ${NUM3}) endfunction() # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞–∫—Ä–æ—Å–∞ "print_words": macro(print_words WORD1 WORD2 WORD3) message(${WORD1} " " ${WORD2} " " ${WORD3}) endmacro() # –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ "print_numbers", –∫–æ—Ç–æ—Ä–∞—è –Ω–∞–ø–µ—á–∞—Ç–∞–µ—Ç "12 89 225": print_numbers(12 89 225) # –í—ã–∑–æ–≤ –º–∞–∫—Ä–æ—Å–∞ "print_words", –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø–µ—á–∞—Ç–∞–µ—Ç "Hey Hello Goodbye": print_words(Hey Hello Goodbye)</span></span></code> </pre> <br><p>  The <a href="https://cmake.org/cmake/help/latest/command/function.html"><code>function</code></a> command first of arguments takes the name of the future function, and the remaining arguments are the names of the parameters with which you can work as with ordinary variables.  The parameters are visible only to the function being defined, which means we cannot get access to its parameters outside the function.  Moreover, all other variables defined and redefined within the function are visible only to it itself. </p><br><p>  Macros are similar to functions with the exception that they do not have their own scope: all variables inside macros are treated as global.  You can read more about the differences between macros and functions <a href="https://stackoverflow.com/questions/24297999/function-vs-macro-in-cmake">here</a> . </p><br><p>  As <a href="https://habr.com/post/431428/">noted</a> in the comments, the macros in CMake are similar to the macros in the C preprocessor: if you put the <a href="https://cmake.org/cmake/help/latest/command/return.html"><code>return</code></a> command in the macro body, then the exit from the calling function (or the entire script) will occur, as this example demonstrates: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–∞–∫—Ä–æ—Å, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–º–∞–Ω–¥—É –≤—ã—Ö–æ–¥–∞: macro(demonstrate_macro) return() endmacro() # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –≤—ã–∑—ã–≤–∞—é—â—É—é –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–∞–∫—Ä–æ—Å: function(demonstrate_func) demonstrate_macro() message("The function was invoked!") endfunction() # –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "Something happened with the function!" demonstrate_func() message("Something happened with the function!")</span></span></code> </pre> <br><p>  In the example above, the function <code>demonstrate_func</code> will not have time to print the message <code>The function was invoked!</code>  , as before, the exit command will be substituted and executed to the place of calling the demonst_macro macro. </p><br><h1 id="razbor-argumentov">  Argument analysis </h1><br><p>  As <a href="https://habr.com/post/432096/">noted</a> in the comments, the powerful <a href="https://cmake.org/cmake/help/latest/command/cmake_parse_arguments.html"><code>cmake_parse_arguments</code></a> mechanism allows for parsing the arguments passed to a function or macro. </p><br><p>  This command accepts a prefix used in defining variables (see the next paragraph), a list of options used without subsequent values, a list of keywords, followed by a single value, a list of keywords, followed by sets of values, and a list of all values ‚Äã‚Äãpassed to the function or macro. </p><br><p>  The work of the argument analysis mechanism is to convert the received arguments into variable values.  Thus, the considered command for each option and keyword defines its own variable of the form <code>&lt;Prefix&gt;_&lt;OptionOrKeyword&gt;</code> , encapsulating some value.  For options, these are boolean values ‚Äã‚Äã(true ‚Äî the option is specified, otherwise, false), and for keywords ‚Äî all passed values ‚Äã‚Äãlocated after them. </p><br><p>  The <code>custom_function</code> function contains a call to the <a href="https://cmake.org/cmake/help/latest/command/cmake_parse_arguments.html"><code>cmake_parse_arguments</code></a> , and then commands to print the values ‚Äã‚Äãof certain variables.  Further, the function is called with arguments <code>LOW NUMBER 30 COLORS red green blue</code> , after which the screen is printed on: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(custom_function) <span class="hljs-comment"><span class="hljs-comment"># –í—ã–∑–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏: cmake_parse_arguments(CUSTOM_FUNCTION "LOW;HIGH" "NUMBER" "COLORS" ${ARGV}) # –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "'LOW' = [TRUE]": message("'LOW' = [${CUSTOM_FUNCTION_LOW}]") #–ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "'HIGH' = [FALSE]": message("'HIGH' = [${CUSTOM_FUNCTION_HIGH}]") # –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "'NUMBER' = [30]": message("'NUMBER' = [${CUSTOM_FUNCTION_NUMBER}]") # –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç "'COLORS' = [red;green;blue]": message("'COLORS' = [${CUSTOM_FUNCTION_COLORS}]") endfunction() # –í—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é "custom_function" —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏: custom_function(LOW NUMBER 30 COLORS red green blue)</span></span></code> </pre> <br><h1 id="oblasti-vidimosti">  Scopes </h1><br><p>  In the previous section, you learned that some constructions in CMake can define their own scopes.  In fact, all variables are considered global by default (they can be accessed everywhere), except for those defined and redefined in functions.  There are also <a href="https://cmake.org/cmake/help/latest/command/set.html">cache variables</a> that have their own scope, but they are not used so often. </p><br><p>  As <a href="https://habr.com/post/431428/">mentioned</a> in the comments, variables can be defined in the "parent" scope with the <code>set(VARIABLE ... PARENT_SCOPE)</code> command <code>set(VARIABLE ... PARENT_SCOPE)</code> .  This example demonstrates this feature: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment"># –§—É–Ω–∫—Ü–∏—è, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é "VARIABLE" —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º # "In the parent scope..." –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏: function(demonstrate_variable) set(VARIABLE "In the parent scope..." PARENT_SCOPE) endfunction() # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é "VARIABLE" –≤ —Ç–µ–∫—É—â–µ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏: demonstrate_variable() # –¢–µ–ø–µ—Ä—å –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π "VARIABLE" –¥–æ—Å—Ç—É–ø: message("'VARIABLE' is equal to: ${VARIABLE}")</span></span></code> </pre> <br><p>  If <code>PARENT_SCOPE</code> removed from the definition of the variable <code>VARIABLE</code> , then the variable will be accessible only to the <code>PARENT_SCOPE</code> function, and in the global scope it will take an empty value. </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  This is where the CMake syntax ends.  <a href="https://habr.com/post/432096">The next article</a> will be released in about a couple of days and will introduce the use of the CMake build system.  See you soon! <br></p></div><p>Source: <a href="https://habr.com/ru/post/431428/">https://habr.com/ru/post/431428/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>