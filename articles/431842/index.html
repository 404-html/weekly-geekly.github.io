<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>0xc00007b or installation of drivers from under the program</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 Good day. Are you familiar with the exception 0xc00007b ? Since the transfer of the X-Ray engine for x64, there have been a lot of re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <div class="page-header-logo-container"></div>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>0xc00007b or installation of drivers from under the program</h1><div class="post__text post__text-html js-mediator-article"><h3>  Introduction </h3><br><p>  Good day.  Are you <b>familiar with the</b> exception <b>0xc00007b</b> ?  Since the transfer of the <a href="https://github.com/xrOxygen/xray-oxygen/">X-Ray</a> engine <a href="https://github.com/xrOxygen/xray-oxygen/">for x64,</a> there have been a lot of reports about the 0cx00007b problem.  In 90% of cases, it was a problem with the lack of a 64 bit OpenAL driver. </p><a name="habracut"></a><br><h3>  Problem Solving Ideas </h3><br><p>  At first, we constantly answered that we need to install the driver, after a couple of months we wrote a FAQ on the launch and possible problems.  But such reports did not go away, the people in our CIS do not particularly like to read, so we decided to solve the problem radically: install the driver from under the engine, if there is no one. </p><br><h3>  Step 1: run the program when there is not enough dll </h3><br><p>  The easiest way to connect libraries to each other is to build ( <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B2%25D1%2582%25D0%25BE%25D1%2581%25D0%25B2%25D1%258F%25D0%25B7%25D1%258B%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">pragma comment</a> ), but in our case this is not possible. </p><br><p> So, step 1: <b><a href="https://msdn.microsoft.com/ru-ru/library/784bt7z7.aspx">explicit linking</a></b> or hi <code>extern "C"</code> . </p><br><p>  What we need: untie exe from engine libraries.  This is done in the following way: </p><br><p>  1) We bring the engine launch function to the dynamic library: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> --<span class="hljs-comment"><span class="hljs-comment">// LoadLibrary, –µ—Å–ª–∏ –º–Ω–µ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç –ø–∞–º—è—Ç—å, –°–∏—à–Ω–æ–µ API { void ENGINE_API RunApplication(LPCSTR commandLine) { ... // Your code } }</span></span></code> </pre> <br><p>  2) Call the function from our exe: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> RunFunc = <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>(__cdecl*)(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*); <span class="hljs-comment"><span class="hljs-comment">// –û–±—ä—è–≤–ª—è–µ–º —É–¥–æ–±–Ω—ã–π –¥–ª—è —Å–µ–±—è —Ç–∏–ø —Ñ—É–Ω–∫—Ü–∏–∏ bool OpenALFound = false; // –û–Ω–æ –Ω–∞–º –ø–æ—Ç–æ–º –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow) { if(OpenALFound) { HMODULE hLib = LoadLibrary("xrEngine.dll"); // –ü–æ–ª—É—á–∞–µ–º –º–æ–¥—É–ª—å —Å –Ω–∞—à–µ–π —Ñ—É–Ω–∫—Ü–∏–µ–π IsRunFunc RunFunc = (IsRunFunc)GetProcAddress(hLib, "RunApplication"); // –ü–æ–ª—É—á–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ –º–æ–¥—É–ª—è RunFunc(params); // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–≤–∏–∂–æ–∫ } return 0; }</span></span></code> </pre> <br><h3 id="shag-2-proverka-drayvera">  Step 2: Check Driver </h3><br><p>  Well, everything is simple, we get the system one (maybe someone will be surprised, but the OS is not always on the C :) partition and check the dll in the driver folder: </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/// R_ASSERT - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∞–∫—Ä–æ—Å—Å, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –Ω–∞ –∏—Å—Ç–∏–Ω—É, –µ—Å–ª–∏ –ª–æ–∂ - –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–≤–µ–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ ... // WinMain code TCHAR szOpenALDir[MAX_PATH] = { 0 }; // –ü–æ–ª—É—á–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø–∞—Ç—á R_ASSERT(GetSystemDirectory(szOpenALDir, MAX_PATH * sizeof(TCHAR))); #ifndef UNICODE _snprintf_s(szOpenALDir, MAX_PATH * sizeof(CHAR), "%s%s", szOpenALDir, "\\OpenAL32.dll"); #else _snwprintf_s(szOpenALDir, MAX_PATH * sizeof(WCHAR), L"%s%s", szOpenALDir, L"\\OpenAL32.dll"); #endif DWORD dwOpenALInstalled = GetFileAttributes(szOpenALDir); // –ê—Ç—Ä–∏–±—É—Ç—ã –≤–∞–ª–∏–¥–Ω—ã–µ, –∑–Ω–∞—á–∏—Ç –¥—Ä–∞–π–≤–µ—Ä –Ω–∞ –º–µ—Å—Ç–µ. –í—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ, –∑–∞–ø—É—Å–∫–∞–µ–º. if (dwOpenALInstalled != INVALID_FILE_ATTRIBUTES) { OpenALFound = true; }</span></span></code> </pre> <br><h3 id="shag-3-fayl-ne-nayden">  Step 3: File not found </h3><br><p>  First of all, we need to ask the administrator for user rights, since  Will have to work with the system directory: </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω–Ω—ã –ª–∏ –º—ã –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ bool IsProcessWithAdminPrivilege() { SID_IDENTIFIER_AUTHORITY NtAuthority = SECURITY_NT_AUTHORITY; LPVOID pAdministratorsGroup = nullptr; BOOL bRet = FALSE; // init SID to control privileges AllocateAndInitializeSid(&amp;NtAuthority, 2, SECURITY_BUILTIN_DOMAIN_RID, DOMAIN_ALIAS_RID_ADMINS, 0, 0, 0, 0, 0, 0, &amp;pAdministratorsGroup); // ckeck membership CheckTokenMembership(nullptr, pAdministratorsGroup, &amp;bRet); // clean pointer if (pAdministratorsGroup) { FreeSid(pAdministratorsGroup); pAdministratorsGroup = nullptr; } return !!bRet; } { ...// WinMain code // –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –ø–æ–ø—Ä–æ—Å–∏–º –∏—Ö –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–º—Å—è if (!IsProcessWithAdminPrivilege()) { TCHAR szPathToLib[MAX_PATH] = { 0 }; GetModuleFileName(nullptr, szPathToLib, ARRAYSIZE(szPathToLib)); SHELLEXECUTEINFO shellInfo = { sizeof(SHELLEXECUTEINFO) }; shellInfo.lpVerb = TEXT("runas"); shellInfo.lpFile = szPathToLib; shellInfo.hwnd = nullptr; shellInfo.nShow = SW_NORMAL; if (ShellExecuteEx(&amp;shellInfo)) ExitProcess(GetCurrentProcessId()); } }</span></span></code> </pre> <br><p>  Stage two: copy the library to the system </p><br><pre> <code class="cpp hljs">{ ... <span class="hljs-comment"><span class="hljs-comment">// WinMain code TCHAR szPath[MAX_PATH] = { 0 }; // –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –±–µ—Ä—É –ø—É—Ç—å –æ—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ GetModuleFileName(GetModuleHandle(nullptr), szPath, MAX_PATH); PathRemoveFileSpec(szPath); #ifndef UNICODE _snprintf_s(szPath, MAX_PATH * sizeof(CHAR), "%s%s", szPath, "\\OpenAL32.dll"); #else _snwprintf_s(szPath, MAX_PATH * sizeof(WCHAR), L"%s%s", szPath, L"\\OpenAL32.dll"); #endif dwOpenALInstalled = GetFileAttributes(szPath); if (dwOpenALInstalled != INVALID_FILE_ATTRIBUTES) // –§–∞–π–ª –Ω–∞–π–¥–µ—Ç, –∏–¥—ë–º –¥–∞–ª—å—à–µ { DWORD LibrarySize = 0; HANDLE hFile = CreateFile(szPath, GENERIC_READ, NULL, nullptr, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, nullptr); R_ASSERT(hFile != INVALID_HANDLE_VALUE); FILE_STANDARD_INFO fileInfo = { 0 }; GetFileInformationByHandleEx(hFile, FileStandardInfo, &amp;fileInfo, sizeof(fileInfo)); LPVOID pImage = HeapAlloc(GetProcessHeap(), 0, fileInfo.EndOfFile.QuadPart); ReadFile(hFile, pImage, fileInfo.EndOfFile.QuadPart, &amp;LibrarySize, nullptr); CloseHandle(hFile); hFile = CreateFile(szOpenALDir, GENERIC_WRITE, NULL, nullptr, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, nullptr); R_ASSERT(hFile != INVALID_HANDLE_VALUE); WriteFile(hFile, pImage, fileInfo.EndOfFile.QuadPart, &amp;LibrarySize, nullptr); HeapFree(GetProcessHeap(), 0, pImage); CloseHandle(hFile); OpenALFound = true; // –ì–æ–≤–æ—Ä–∏–º, —á—Ç–æ –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –¥–≤–∏–∂–æ–∫ } }</span></span></code> </pre> <br><h3 id="vyvod">  Conclusion </h3><br><p>  Of course, the method is very funny, but it is suitable for such projects.  Good luck to all! </p></div><p>Source: <a href="https://habr.com/ru/post/431842/">https://habr.com/ru/post/431842/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>