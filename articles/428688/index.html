<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up the Docker desktop environment for the yii-framework application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In order to quickly raise the working environment there are many ways. One of them is to pick up all the necessary services in the Docker containers. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up the Docker desktop environment for the yii-framework application</h1><div class="post__text post__text-html js-mediator-article"><p>  In order to quickly raise the working environment there are many ways.  One of them is to pick up all the necessary services in the Docker containers.  To speed up the creation of new projects on the Yii-framework, I wrote such a small instruction that is used by the developers in our team. </p><a name="habracut"></a><br><p>  At the start you should have docker, docker-compose, php and php-composer. <br>  Create a folder with the project and the <em>docker</em> folder in it. </p><br><pre><code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> project-<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> project-<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> docker</code> </pre> <br><p>  In the <em>docker</em> folder, create a configuration file for our <strong>Dockerfile</strong> container. </p><br><pre> <code class="hljs pgsql"># –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ —Å nginx –∏ php <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> richarvey/nginx-php-fpm # –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—à–µ –≤–µ–± –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> app /var/www/app # –£–¥–∞–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥–∏ —Å–∞–π—Ç–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ —Ç–∞–º –µ—Å—Ç—å RUN rm -Rf /etc/nginx/sites-enabled<span class="hljs-comment"><span class="hljs-comment">/* # –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—à –∫–æ–Ω—Ñ–∏–≥ ADD docker/conf/nginx/site.conf /etc/nginx/sites-available/site.conf # –í–∫–ª—é—á–∞–µ–º –µ–≥–æ RUN ln -s /etc/nginx/sites-available/site.conf /etc/nginx/sites-enabled/site.conf</span></span></code> </pre> <br><p>  In the same <em>docker</em> folder, create <strong>docker-compose.yml</strong> to raise the development environment. </p><br><pre> <code class="hljs pgsql"># –ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è docker-compose <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>: <span class="hljs-string"><span class="hljs-string">'3'</span></span> # –°–æ–∑–¥–∞–µ–º –æ–±—â—É—é —Å–µ—Ç—å deafult –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ networks: <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: driver: bridge # –°–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã services: # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º app: # –°–æ–±–∏—Ä–∞–µ–º –∏–∑ Dockerfile build: # –ö–æ—Ä–Ω–µ–º —É–∫–∞–∑—ã–≤–∞–µ–º –∫–æ—Ä–µ–Ω—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ context: ../ dockerfile: ./docker/Dockerfile # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Ä—É–∂—É <span class="hljs-number"><span class="hljs-number">80</span></span> –ø–æ—Ä—Ç ports: - "80:80" # –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫ –æ–±—â–µ–π —Å–µ—Ç–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ networks: - <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ db depends_on: - db # –õ–∏–Ω–∫—É–µ–º –≤–Ω–µ—à–Ω—é—é –ø–∞–ø–∫—É —Å –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º–∏ –≤–Ω—É—Ç—Ä—å volumes: - "../app:/var/www/app" # –¢–∞–∫ –∂–µ –ª–∏–Ω–∫—É–µ–º –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è nginx - "./conf/nginx:/etc/nginx/sites-available" # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö db: image: mysql:latest # –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫ –æ–±—â–µ–π —Å–µ—Ç–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ networks: - <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Ä—É–∂—É –ø–æ—Ä—Ç ports: - "3336:3306" # –ó–∞–¥–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î environment: # –ü–∞—Ä–æ–ª—å –∫ –ë–î MYSQL_ROOT_PASSWORD: root # –°–æ–∑–¥–∞–≤–∞–µ–º–∞—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–¥ MYSQL_DATABASE: yii-<span class="hljs-keyword"><span class="hljs-keyword">template</span></span>-db # –õ–∏–Ω–∫—É–µ–º –≤–Ω–µ—à–Ω—é—é –ø–∞–ø–∫—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ë–î volumes: - "./database:/var/lib/mysql"</code> </pre> <br><p>  For nginx, create the <em>docker / conf / nginx</em> folder and the <strong>site.conf</strong> file in it.  The file may change, depending on how you want to configure nginx on your project.  It can be changed locally, since  It connects through volume.  But do not forget to reload nginx inside the container: <code>nginx -s reload</code> </p><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">charset</span></span> utf-<span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">client_max_body_size</span></span> <span class="hljs-number"><span class="hljs-number">128M</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-comment"><span class="hljs-comment">## listen for ipv4 root /var/www/app/frontend/web/; index index.php; access_log /var/www/app/log/frontend-access.log; error_log /var/www/app/log/frontend-error.log; location / { try_files $uri $uri/ /index.php$is_args$args; } # uncomment to avoid processing of calls to non-existing static files by Yii #location ~ \.(js|css|png|jpg|gif|swf|ico|pdf|mov|fla|zip|rar)$ { # try_files $uri =404; #} #error_page 404 /404.html; # deny accessing php files for the /assets directory location ~ ^/assets/.*\.php$ { deny all; } location ~ \.php$ { include fastcgi_params; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; fastcgi_pass unix:/var/run/php-fpm.sock; try_files $uri =404; } location ~* /\. { deny all; } }</span></span></code> </pre> <br><p>  All commands are executed from the root folder. </p><br><ul><li>  We execute the command to create a project <code>composer create-project --prefer-dist yiisoft/yii2-app-advanced app</code> . </li><li>  Run the <code>docker-compose -f docker/docker-compose.yml up -d</code> environment <code>docker-compose -f docker/docker-compose.yml up -d</code> </li><li>  Initializing the project <code>app/init --env=Development --overwrite=All</code> </li><li>  Open the file <em>app / common / config / main-local.php in the editor</em> and fill it with data for connecting to the database.  In the example we have the root password - root, the database host is db, the database name is yii-template-db. </li><li>  Connect to <code>docker exec -it docker_app_1 bash</code> container <code>docker exec -it docker_app_1 bash</code> </li><li>  Execute the database migration command <code>php /var/www/app/yii migrate</code> </li><li>  Create a folder for the logs <code>mkdir /var/www/app/log</code> </li><li>  And exit <code>exit</code> </li><li>  Brake <code>docker-compose -f docker/docker-compose.yml down</code> </li><li>  Run it again <code>docker-compose -f docker/docker-compose.yml up -d</code> </li><li>  Open <em>localhost</em> in the browser and look at the new site. </li></ul><br><p>  Upd: It is definitely worth mentioning that there is always an <a href="https://github.com/yiisoft/yii2-docker">official Docker image of Yii2</a> . </p></div><p>Source: <a href="https://habr.com/ru/post/428688/">https://habr.com/ru/post/428688/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><p>Waiting for the list form <a href="../../index.html">here</a>...</p></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>